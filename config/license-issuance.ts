/**
 * HARMONIC insight 繝ｩ繧､繧ｻ繝ｳ繧ｹ逋ｺ陦後・驟榊ｸ・す繧ｹ繝・Β
 *
 * ============================================================================
 * 縲心yncfusion 繝｢繝・Ν繧貞盾閠・↓縺励◆繝ｩ繧､繧ｻ繝ｳ繧ｹ逋ｺ陦後ヵ繝ｭ繝ｼ縲・
 * ============================================================================
 *
 * ## Syncfusion 縺ｮ豬√ｌ・亥盾閠・・・・
 * 1. 繝ｦ繝ｼ繧ｶ繝ｼ縺後Γ繝ｼ繝ｫ繧｢繝峨Ξ繧ｹ縺ｧ逋ｻ骭ｲ
 * 2. 縲靴onfirm and Verify縲阪Γ繝ｼ繝ｫ縺悟ｱ翫￥・・5譌･髢捺怏蜉ｹ・・
 * 3. 繝｡繝ｼ繝ｫ隱崎ｨｼ螳御ｺ・
 * 4. 蜊ｳ蠎ｧ縺ｫ 7譌･髢薙・莉ｮ繝ｩ繧､繧ｻ繝ｳ繧ｹ繧ｭ繝ｼ繧偵Γ繝ｼ繝ｫ縺ｧ逋ｺ陦・
 * 5. 蟇ｩ譟ｻ螳御ｺ・ｾ後・聞譛溘Λ繧､繧ｻ繝ｳ繧ｹ繧ｭ繝ｼ繧貞挨騾秘∽ｻ・
 *
 * ## HARMONIC insight 縺ｮ豬√ｌ・域悽螳溯｣・ｼ・
 *
 * 笏娯楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏・
 * 笏・                   繝ｩ繧､繧ｻ繝ｳ繧ｹ逋ｺ陦後ヵ繝ｭ繝ｼ                          笏・
 * 笏・                                                                笏・
 * 笏・ 竭 逋ｻ骭ｲ            竭｡ 繝｡繝ｼ繝ｫ隱崎ｨｼ        竭｢ 莉ｮ繧ｭ繝ｼ逋ｺ陦・           笏・
 * 笏・ 笏娯楳笏笏笏笏笏笏笏笏笏笏・   笏娯楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏・   笏娯楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏・         笏・
 * 笏・ 笏・繝｡繝ｼ繝ｫ    笏・竊・ 笏・Confirm &    笏・竊・ 笏・7譌･髢典RIAL   笏・         笏・
 * 笏・ 笏・陬ｽ蜩・∈謚・ 笏・   笏・Verify       笏・   笏・繧ｭ繝ｼ閾ｪ蜍慕匱陦・ 笏・         笏・
 * 笏・ 笏・繝励Λ繝ｳ驕ｸ謚樞狽    笏・(15譌･髢捺怏蜉ｹ) 笏・   笏・+ DL繝ｪ繝ｳ繧ｯ   笏・         笏・
 * 笏・ 笏披楳笏笏笏笏笏笏笏笏笏笏・   笏披楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏・   笏披楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏・         笏・
 * 笏・                                                                笏・
 * 笏・ 竭｣ 豎ｺ貂・謇ｿ隱・      竭､ 豁｣蠑上く繝ｼ逋ｺ陦・     竭･ 蛻ｩ逕ｨ髢句ｧ・             笏・
 * 笏・ 笏娯楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏・笏娯楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏・笏娯楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏・          笏・
 * 笏・ 笏・Paddle/Stripe笏・笏・12繝ｶ譛医く繝ｼ   笏・笏・繧｢繝励Μ蜀・〒    笏・          笏・
 * 笏・ 笏・隲区ｱよ嶌謇輔＞   笏や・笏・繝｡繝ｼ繝ｫ騾∽ｻ・  笏や・笏・繧｢繧ｯ繝・ぅ繝吶・繝遺狽           笏・
 * 笏・ 笏・繝ｪ繧ｻ繝ｩ繝ｼ邨檎罰 笏・笏・             笏・笏・             笏・          笏・
 * 笏・ 笏披楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏・笏披楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏・笏披楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏・          笏・
 * 笏披楳笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏笏・
 *
 * ## 繧ｭ繝ｼ縺ｮ遞ｮ鬘・
 * - 莉ｮ繧ｭ繝ｼ・・rovisional Key・・ 7譌･髢捺怏蜉ｹ縲ゝRIAL逶ｸ蠖薙√Γ繝ｼ繝ｫ隱崎ｨｼ蠕悟叉逋ｺ陦・
 * - 豁｣蠑上く繝ｼ・・roduction Key・・ 12繝ｶ譛域怏蜉ｹ縲∵ｱｺ貂亥ｮ御ｺ・ｾ後↓逋ｺ陦・
 * - NFR繧ｭ繝ｼ・・ot For Resale・・ 繝ｪ繧ｻ繝ｩ繝ｼ繝代・繝医リ繝ｼ遉ｾ蜀・ｩ穂ｾ｡逕ｨ
 * - 繝・Δ繧ｭ繝ｼ・・emo Key・・ 繝ｪ繧ｻ繝ｩ繝ｼ縺碁｡ｧ螳｢繝・Δ縺ｫ菴ｿ逕ｨ
 */

import type { ProductCode, PlanCode } from './products';

// =============================================================================
// 蝙句ｮ夂ｾｩ
// =============================================================================

/** 繝ｩ繧､繧ｻ繝ｳ繧ｹ繧ｭ繝ｼ縺ｮ遞ｮ鬘・*/
export type LicenseKeyType =
  | 'provisional'   // 莉ｮ繧ｭ繝ｼ・・譌･髢薙√Γ繝ｼ繝ｫ隱崎ｨｼ蠕悟叉逋ｺ陦鯉ｼ・
  | 'production'    // 豁｣蠑上く繝ｼ・・2繝ｶ譛医∵ｱｺ貂亥ｮ御ｺ・ｾ鯉ｼ・
  | 'nfr'           // Not For Resale・医ヱ繝ｼ繝医リ繝ｼ遉ｾ蜀・畑・・
  | 'demo';         // 繝・Δ逕ｨ・医ヱ繝ｼ繝医リ繝ｼ縺碁｡ｧ螳｢繝・Δ縺ｫ菴ｿ逕ｨ・・

/** 逋ｻ骭ｲ繧ｹ繝・・繧ｿ繧ｹ */
export type RegistrationStatus =
  | 'pending_verification'  // 繝｡繝ｼ繝ｫ隱崎ｨｼ蠕・■
  | 'verified'              // 隱崎ｨｼ貂医∩・井ｻｮ繧ｭ繝ｼ逋ｺ陦梧ｸ医∩・・
  | 'pending_payment'       // 豎ｺ貂亥ｾ・■
  | 'active'                // 豁｣蠑上く繝ｼ逋ｺ陦梧ｸ医∩繝ｻ蛻ｩ逕ｨ荳ｭ
  | 'expired'               // 譛滄剞蛻・ｌ
  | 'suspended';            // 蛛懈ｭ｢

/** 繝｡繝ｼ繝ｫ繝・Φ繝励Ξ繝ｼ繝育ｨｮ蛻･ */
export type EmailTemplate =
  | 'verification'          // Step 竭｡: 繝｡繝ｼ繝ｫ隱崎ｨｼ
  | 'provisional_key'       // Step 竭｢: 莉ｮ繧ｭ繝ｼ逋ｺ陦・
  | 'payment_confirmation'  // Step 竭｣: 豎ｺ貂育｢ｺ隱・
  | 'production_key'        // Step 竭､: 豁｣蠑上く繝ｼ逋ｺ陦・
  | 'expiry_reminder'       // 譛滄剞蛻・ｌ30譌･蜑阪Μ繝槭う繝ｳ繝繝ｼ
  | 'expiry_notice'         // 譛滄剞蛻・ｌ騾夂衍
  | 'renewal_confirmation'; // 譖ｴ譁ｰ螳御ｺ・

/** 繝ｩ繧､繧ｻ繝ｳ繧ｹ逋ｻ骭ｲ諠・ｱ */
export interface LicenseRegistration {
  /** 逋ｻ骭ｲID */
  id: string;
  /** 繝｡繝ｼ繝ｫ繧｢繝峨Ξ繧ｹ */
  email: string;
  /** 豌丞錐 */
  name: string;
  /** 莨夂､ｾ蜷搾ｼ井ｻｻ諢擾ｼ・*/
  company?: string;
  /** 陬ｽ蜩√さ繝ｼ繝・*/
  productCode: ProductCode;
  /** 蟶梧悍繝励Λ繝ｳ */
  requestedPlan: PlanCode;
  /** 逋ｻ骭ｲ繧ｹ繝・・繧ｿ繧ｹ */
  status: RegistrationStatus;
  /** 隱崎ｨｼ繝医・繧ｯ繝ｳ */
  verificationToken: string;
  /** 隱崎ｨｼ繝医・繧ｯ繝ｳ譛牙柑譛滄剞 */
  verificationExpiresAt: Date;
  /** 隱崎ｨｼ螳御ｺ・律譎・*/
  verifiedAt: Date | null;
  /** 莉ｮ繧ｭ繝ｼ */
  provisionalKey: string | null;
  /** 莉ｮ繧ｭ繝ｼ譛牙柑譛滄剞 */
  provisionalExpiresAt: Date | null;
  /** 豁｣蠑上く繝ｼ */
  productionKey: string | null;
  /** 豁｣蠑上く繝ｼ譛牙柑譛滄剞 */
  productionExpiresAt: Date | null;
  /** 豎ｺ貂域婿豕・*/
  paymentMethod: 'paddle' | 'stripe' | 'invoice' | 'reseller' | null;
  /** 豎ｺ貂・D */
  paymentId: string | null;
  /** 繝ｪ繧ｻ繝ｩ繝ｼ繝代・繝医リ繝ｼID・医Μ繧ｻ繝ｩ繝ｼ邨檎罰縺ｮ蝣ｴ蜷茨ｼ・*/
  resellerPartnerId: string | null;
  /** 逋ｻ骭ｲ譌･譎・*/
  createdAt: Date;
  /** 譖ｴ譁ｰ譌･譎・*/
  updatedAt: Date;
}

// =============================================================================
// 繝ｩ繧､繧ｻ繝ｳ繧ｹ繧ｭ繝ｼ逕滓・繝ｫ繝ｼ繝ｫ
// =============================================================================

/**
 * 繝ｩ繧､繧ｻ繝ｳ繧ｹ繧ｭ繝ｼ蠖｢蠑・
 *
 * 豁｣蠑上く繝ｼ:  {PRODUCT}-{PLAN}-{YYMM}-{HASH}-{SIG1}-{SIG2}
 * 莉ｮ繧ｭ繝ｼ:    {PRODUCT}-TRIAL-{YYMM}-{HASH}-{SIG1}-{SIG2}
 * NFR繧ｭ繝ｼ:   {PRODUCT}-NFR-{YYMM}-{HASH}-{SIG1}-{SIG2}
 * 繝・Δ繧ｭ繝ｼ:  {PRODUCT}-DEMO-{YYMM}-{HASH}-{SIG1}-{SIG2}
 *
 * 萓・
 *   INSS-STD-2602-A3F1-B7C2-D9E4    ・域ｭ｣蠑上く繝ｼ: STD繝励Λ繝ｳ縲・026蟷ｴ2譛育匱陦鯉ｼ・
 *   INSS-TRIAL-2602-X1Y2-Z3W4-V5U6  ・井ｻｮ繧ｭ繝ｼ: 7譌･髢難ｼ・
 *   IOSH-NFR-2602-N1F2-R3P4-Q5S6    ・・FR繧ｭ繝ｼ: 繝代・繝医リ繝ｼ逕ｨ・・
 */
export interface LicenseKeyConfig {
  /** 繧ｭ繝ｼ遞ｮ蛻･ */
  type: LicenseKeyType;
  /** 譛牙柑譌･謨ｰ */
  validityDays: number;
  /** 蟇ｾ蠢懊☆繧九・繝ｩ繝ｳ繧ｳ繝ｼ繝会ｼ域ｩ溯・蛻ｶ髯舌↓菴ｿ逕ｨ・・*/
  effectivePlan: PlanCode;
  /** 繧ｭ繝ｼ縺ｫ蝓九ａ霎ｼ繧繝励Λ繝ｳ陦ｨ險・*/
  keyPlanCode: string;
  /** 隱ｬ譏・*/
  description: string;
}

export const LICENSE_KEY_CONFIGS: Record<LicenseKeyType, LicenseKeyConfig> = {
  provisional: {
    type: 'provisional',
    validityDays: 7,
    effectivePlan: 'TRIAL',
    keyPlanCode: 'TRIAL',
    description: '繝｡繝ｼ繝ｫ隱崎ｨｼ蠕後↓蜊ｳ逋ｺ陦後・譌･髢灘・讖溯・蛻ｩ逕ｨ蜿ｯ閭ｽ縲・,
  },
  production: {
    type: 'production',
    validityDays: 365,
    effectivePlan: 'STD', // 豎ｺ貂域凾縺ｮ繝励Λ繝ｳ縺ｧ荳頑嶌縺・
    keyPlanCode: 'STD',   // 豎ｺ貂域凾縺ｮ繝励Λ繝ｳ縺ｧ荳頑嶌縺・
    description: '豎ｺ貂亥ｮ御ｺ・ｾ後↓逋ｺ陦後・2繝ｶ譛磯俣譛牙柑縲・,
  },
  nfr: {
    type: 'nfr',
    validityDays: 365,
    effectivePlan: 'PRO',
    keyPlanCode: 'NFR',
    description: '繝ｪ繧ｻ繝ｩ繝ｼ繝代・繝医リ繝ｼ遉ｾ蜀・ｩ穂ｾ｡逕ｨ縲１RO逶ｸ蠖薙・蜈ｨ讖溯・縲・,
  },
  demo: {
    type: 'demo',
    validityDays: 30,
    effectivePlan: 'TRIAL',
    keyPlanCode: 'DEMO',
    description: '繝ｪ繧ｻ繝ｩ繝ｼ縺碁｡ｧ螳｢繝・Δ縺ｫ菴ｿ逕ｨ縲・0譌･髢灘・讖溯・縲・,
  },
};

// =============================================================================
// 繝｡繝ｼ繝ｫ隱崎ｨｼ險ｭ螳・
// =============================================================================

export const VERIFICATION_CONFIG = {
  /** 隱崎ｨｼ繝ｪ繝ｳ繧ｯ譛牙柑譛滄俣・域律・・*/
  tokenExpiryDays: 15,
  /** 隱崎ｨｼ繝｡繝ｼ繝ｫ蜀埼∝庄閭ｽ蝗樊焚 */
  maxResendCount: 3,
  /** 隱崎ｨｼ繝｡繝ｼ繝ｫ蜀埼・俣髫費ｼ育ｧ抵ｼ・*/
  resendCooldownSeconds: 60,
  /** 隱崎ｨｼURL蠖｢蠑・*/
  verificationUrlPattern: 'https://account.harmonicinsight.com/verify?token={token}',
};

// =============================================================================
// 繧ｹ繝・ャ繝怜挨蜃ｦ逅・ｮ夂ｾｩ
// =============================================================================

/**
 * Step 竭: 繝ｦ繝ｼ繧ｶ繝ｼ逋ｻ骭ｲ
 *
 * 繝医Μ繧ｬ繝ｼ: Web繝輔か繝ｼ繝騾∽ｿ｡
 * 蜃ｦ逅・
 *   1. registrations 繝・・繝悶Ν縺ｫ逋ｻ骭ｲ・・tatus: pending_verification・・
 *   2. 隱崎ｨｼ繝医・繧ｯ繝ｳ逕滓・・・UID v4縲・5譌･髢捺怏蜉ｹ・・
 *   3. 隱崎ｨｼ繝｡繝ｼ繝ｫ騾∽ｿ｡
 */
export interface Step1_RegistrationInput {
  email: string;
  name: string;
  company?: string;
  productCode: ProductCode;
  requestedPlan: PlanCode;
  locale: 'ja' | 'en';
}

/**
 * Step 竭｡: 繝｡繝ｼ繝ｫ隱崎ｨｼ
 *
 * 繝医Μ繧ｬ繝ｼ: 隱崎ｨｼ繝ｪ繝ｳ繧ｯ縺ｮ繧ｯ繝ｪ繝・け
 * 蜃ｦ逅・
 *   1. 繝医・繧ｯ繝ｳ讀懆ｨｼ・域怏蜉ｹ譛滄剞繝√ぉ繝・け・・
 *   2. status 繧・verified 縺ｫ譖ｴ譁ｰ
 *   3. verifiedAt 繧定ｨ倬鹸
 *   4. 竊・Step 竭｢ 繧貞叉螳溯｡・
 */
export interface Step2_VerificationInput {
  token: string;
}

/**
 * Step 竭｢: 莉ｮ繧ｭ繝ｼ逋ｺ陦・
 *
 * 繝医Μ繧ｬ繝ｼ: Step 竭｡ 螳御ｺ・凾縺ｫ閾ｪ蜍募ｮ溯｡・
 * 蜃ｦ逅・
 *   1. 莉ｮ繝ｩ繧､繧ｻ繝ｳ繧ｹ繧ｭ繝ｼ逕滓・・・RIAL縲・譌･髢難ｼ・
 *   2. registrations 繝・・繝悶Ν縺ｫ莉ｮ繧ｭ繝ｼ繧定ｨ倬鹸
 *   3. 莉ｮ繧ｭ繝ｼ逋ｺ陦後Γ繝ｼ繝ｫ騾∽ｿ｡・郁｣ｽ蜩．L繝ｪ繝ｳ繧ｯ莉倥″・・
 *   4. licenses 繝・・繝悶Ν縺ｫTRIAL縺ｨ縺励※逋ｻ骭ｲ
 */
export interface Step3_ProvisionalKeyOutput {
  provisionalKey: string;
  expiresAt: Date;
  downloadLinks: ProductDownloadLinks;
}

/**
 * Step 竭｣: 豎ｺ貂医・謇ｿ隱・
 *
 * 繝医Μ繧ｬ繝ｼ: Paddle/Stripe webhook or 繝ｪ繧ｻ繝ｩ繝ｼ豕ｨ譁・or 隲区ｱよ嶌謇輔＞遒ｺ隱・
 * 蜃ｦ逅・
 *   1. 豎ｺ貂域ュ蝣ｱ繧定ｨ倬鹸
 *   2. status 繧・active 縺ｫ譖ｴ譁ｰ
 *   3. 竊・Step 竭､ 繧貞叉螳溯｡・
 */
export interface Step4_PaymentInput {
  registrationId: string;
  paymentMethod: 'paddle' | 'stripe' | 'invoice' | 'reseller';
  paymentId: string;
  plan: PlanCode;
  resellerPartnerId?: string;
}

/**
 * Step 竭､: 豁｣蠑上く繝ｼ逋ｺ陦・
 *
 * 繝医Μ繧ｬ繝ｼ: Step 竭｣ 螳御ｺ・凾縺ｫ閾ｪ蜍募ｮ溯｡・
 * 蜃ｦ逅・
 *   1. 豁｣蠑上Λ繧､繧ｻ繝ｳ繧ｹ繧ｭ繝ｼ逕滓・・域ｱｺ貂医・繝ｩ繝ｳ縺ｧ12繝ｶ譛茨ｼ・
 *   2. licenses 繝・・繝悶Ν繧呈峩譁ｰ・・RIAL 竊・豁｣蠑上・繝ｩ繝ｳ・・
 *   3. 豁｣蠑上く繝ｼ逋ｺ陦後Γ繝ｼ繝ｫ騾∽ｿ｡
 */
export interface Step5_ProductionKeyOutput {
  productionKey: string;
  plan: PlanCode;
  expiresAt: Date;
}

/**
 * Step 竭･: 蛻ｩ逕ｨ髢句ｧ・
 *
 * 繝医Μ繧ｬ繝ｼ: 繝ｦ繝ｼ繧ｶ繝ｼ縺後い繝励Μ蜀・〒繝ｩ繧､繧ｻ繝ｳ繧ｹ繧ｭ繝ｼ繧貞・蜉・
 * 蜃ｦ逅・
 *   - activate-license.ts 縺ｮ譌｢蟄倥ヵ繝ｭ繝ｼ繧剃ｽｿ逕ｨ
 *   - 繧｢繝励Μ蜀・・繝ｩ繧､繧ｻ繝ｳ繧ｹ逕ｻ髱｢縺ｧ繧ｭ繝ｼ繧貞・蜉・竊・繧｢繧ｯ繝・ぅ繝吶・繝・
 */

// =============================================================================
// 陬ｽ蜩√ム繧ｦ繝ｳ繝ｭ繝ｼ繝峨Μ繝ｳ繧ｯ
// =============================================================================

export interface ProductDownloadLinks {
  productCode: ProductCode;
  productName: string;
  /** Windows繧､繝ｳ繧ｹ繝医・繝ｩ繝ｼ */
  windows?: string;
  /** macOS繧､繝ｳ繧ｹ繝医・繝ｩ繝ｼ */
  mac?: string;
  /** Linux繧､繝ｳ繧ｹ繝医・繝ｩ繝ｼ */
  linux?: string;
  /** Web迚・RL */
  web?: string;
  /** 繝峨く繝･繝｡繝ｳ繝・*/
  documentation: string;
  /** API繝ｪ繝輔ぃ繝ｬ繝ｳ繧ｹ */
  apiReference?: string;
}

/** 陬ｽ蜩∝挨繝繧ｦ繝ｳ繝ｭ繝ｼ繝峨Μ繝ｳ繧ｯ・医ユ繝ｳ繝励Ξ繝ｼ繝茨ｼ・*/
export const PRODUCT_DOWNLOAD_LINKS: Record<ProductCode, ProductDownloadLinks> = {
  INSS: {
    productCode: 'INSS',
    productName: 'InsightOfficeSlide',
    windows: 'https://download.harmonicinsight.com/insightofficeslide/latest/windows',
    documentation: 'https://docs.harmonicinsight.com/insightofficeslide',
  },
  INPY: {
    productCode: 'INPY',
    productName: 'InsightPy',
    windows: 'https://download.harmonicinsight.com/insightpy/latest/windows',
    documentation: 'https://docs.harmonicinsight.com/insightpy',
  },
  IOSH: {
    productCode: 'IOSH',
    productName: 'InsightOfficeSheet',
    windows: 'https://download.harmonicinsight.com/insightofficesheet/latest/windows',
    documentation: 'https://docs.harmonicinsight.com/insightofficesheet',
  },
  IOSD: {
    productCode: 'IOSD',
    productName: 'InsightOfficeDoc',
    windows: 'https://download.harmonicinsight.com/insightofficedoc/latest/windows',
    documentation: 'https://docs.harmonicinsight.com/insightofficedoc',
  },
  INCA: {
    productCode: 'INCA',
    productName: 'InsightNoCodeAnalyzer',
    windows: 'https://download.harmonicinsight.com/insightnocode/latest/windows',
    documentation: 'https://docs.harmonicinsight.com/insightnocode',
  },
  INBT: {
    productCode: 'INBT',
    productName: 'InsightBot',
    windows: 'https://download.harmonicinsight.com/insightbot/latest/windows',
    documentation: 'https://docs.harmonicinsight.com/insightbot',
  },
  INMV: {
    productCode: 'INMV',
    productName: 'InsightCast',
    windows: 'https://download.harmonicinsight.com/InsightCast/latest/windows',
    documentation: 'https://docs.harmonicinsight.com/InsightCast',
  },
  INIG: {
    productCode: 'INIG',
    productName: 'InsightImageGen',
    windows: 'https://download.harmonicinsight.com/insightimagegen/latest/windows',
    documentation: 'https://docs.harmonicinsight.com/insightimagegen',
  },
  IVIN: {
    productCode: 'IVIN',
    productName: 'InterviewInsight',
    windows: 'https://download.harmonicinsight.com/insightinterview/latest/windows',
    documentation: 'https://docs.harmonicinsight.com/insightinterview',
  },
  ISOF: {
    productCode: 'ISOF',
    productName: 'InsightSeniorOffice',
    windows: 'https://download.harmonicinsight.com/insightsenioroffice/latest/windows',
    documentation: 'https://docs.harmonicinsight.com/insightsenioroffice',
  },
};

// =============================================================================
// 繝｡繝ｼ繝ｫ繝・Φ繝励Ξ繝ｼ繝亥ｮ夂ｾｩ
// =============================================================================

export interface EmailTemplateConfig {
  template: EmailTemplate;
  subject: {
    ja: string;
    en: string;
  };
  description: string;
  /** 騾∽ｿ｡繧ｿ繧､繝溘Φ繧ｰ */
  trigger: string;
}

export const EMAIL_TEMPLATES: Record<EmailTemplate, EmailTemplateConfig> = {
  verification: {
    template: 'verification',
    subject: {
      ja: '縲食ARMONIC insight縲代Γ繝ｼ繝ｫ繧｢繝峨Ξ繧ｹ縺ｮ遒ｺ隱・,
      en: '[HARMONIC insight] Verify your email address',
    },
    description: '繝｡繝ｼ繝ｫ隱崎ｨｼ繝ｪ繝ｳ繧ｯ莉倥″縲・onfirm and Verify繝懊ち繝ｳ縲・5譌･髢捺怏蜉ｹ縲・,
    trigger: 'Step 竭 逋ｻ骭ｲ逶ｴ蠕・,
  },
  provisional_key: {
    template: 'provisional_key',
    subject: {
      ja: '縲食ARMONIC insight縲捜productName} 窶・7譌･髢薙ヨ繝ｩ繧､繧｢繝ｫ繧ｭ繝ｼ',
      en: '[HARMONIC insight] {productName} 窶・Your 7-Day Trial Key',
    },
    description: '7譌･髢謎ｻｮ繧ｭ繝ｼ + 陬ｽ蜩√ム繧ｦ繝ｳ繝ｭ繝ｼ繝峨Μ繝ｳ繧ｯ + 繝峨く繝･繝｡繝ｳ繝医Μ繝ｳ繧ｯ縲・,
    trigger: 'Step 竭｡ 繝｡繝ｼ繝ｫ隱崎ｨｼ螳御ｺ・峩蠕・,
  },
  payment_confirmation: {
    template: 'payment_confirmation',
    subject: {
      ja: '縲食ARMONIC insight縲代♀謾ｯ謇輔＞遒ｺ隱・窶・{productName} {planName}',
      en: '[HARMONIC insight] Payment Confirmed 窶・{productName} {planName}',
    },
    description: '豎ｺ貂亥ｮ御ｺ・｢ｺ隱阪よｭ｣蠑上く繝ｼ縺ｯ蛻･繝｡繝ｼ繝ｫ縺ｧ騾∽ｻ倥☆繧区葎繧呈｡亥・縲・,
    trigger: 'Step 竭｣ 豎ｺ貂亥ｮ御ｺ・凾',
  },
  production_key: {
    template: 'production_key',
    subject: {
      ja: '縲食ARMONIC insight縲捜productName} {planName} 窶・豁｣蠑上Λ繧､繧ｻ繝ｳ繧ｹ繧ｭ繝ｼ',
      en: '[HARMONIC insight] {productName} {planName} 窶・Your License Key',
    },
    description: '豁｣蠑上く繝ｼ・・2繝ｶ譛茨ｼ・+ 繧｢繧ｯ繝・ぅ繝吶・繧ｷ繝ｧ繝ｳ謇矩・+ 繧ｵ繝昴・繝磯｣邨｡蜈医・,
    trigger: 'Step 竭､ 豎ｺ貂亥ｮ御ｺ・ｾ悟叉譎ゑｼ医∪縺溘・蟇ｩ譟ｻ螳御ｺ・ｾ鯉ｼ・,
  },
  expiry_reminder: {
    template: 'expiry_reminder',
    subject: {
      ja: '縲食ARMONIC insight縲捜productName} 窶・繝ｩ繧､繧ｻ繝ｳ繧ｹ譖ｴ譁ｰ縺ｮ縺顔衍繧峨○・域ｮ九ｊ30譌･・・,
      en: '[HARMONIC insight] {productName} 窶・License Renewal Reminder (30 days)',
    },
    description: '譛滄剞蛻・ｌ30譌･蜑阪↓閾ｪ蜍暮∽ｿ｡縲よ峩譁ｰ繝ｪ繝ｳ繧ｯ莉倥″縲・,
    trigger: '譛滄剞蛻・ｌ30譌･蜑搾ｼ医ヰ繝・メ蜃ｦ逅・ｼ・,
  },
  expiry_notice: {
    template: 'expiry_notice',
    subject: {
      ja: '縲食ARMONIC insight縲捜productName} 窶・繝ｩ繧､繧ｻ繝ｳ繧ｹ縺ｮ譛牙柑譛滄剞縺悟・繧後∪縺励◆',
      en: '[HARMONIC insight] {productName} 窶・Your License Has Expired',
    },
    description: '譛滄剞蛻・ｌ騾夂衍縲よ峩譁ｰ繝ｪ繝ｳ繧ｯ + FREE讖溯・縺ｮ譯亥・縲・,
    trigger: '譛滄剞蛻・ｌ蠖捺律・医ヰ繝・メ蜃ｦ逅・ｼ・,
  },
  renewal_confirmation: {
    template: 'renewal_confirmation',
    subject: {
      ja: '縲食ARMONIC insight縲捜productName} 窶・繝ｩ繧､繧ｻ繝ｳ繧ｹ譖ｴ譁ｰ螳御ｺ・,
      en: '[HARMONIC insight] {productName} 窶・License Renewal Confirmed',
    },
    description: '譖ｴ譁ｰ螳御ｺ・+ 譁ｰ縺励＞繧ｭ繝ｼ + 譁ｰ縺励＞譛牙柑譛滄剞縲・,
    trigger: '譖ｴ譁ｰ豎ｺ貂亥ｮ御ｺ・凾',
  },
};

// =============================================================================
// DB繧ｹ繧ｭ繝ｼ繝橸ｼ・upabase 繝・・繝悶Ν螳夂ｾｩ・・
// =============================================================================

/**
 * registrations 繝・・繝悶Ν
 *
 * 繝ｩ繧､繧ｻ繝ｳ繧ｹ逋ｻ骭ｲ縲懃匱陦後∪縺ｧ縺ｮ蜈ｨ繧ｹ繝・・繧ｿ繧ｹ繧堤ｮ｡逅・・
 * licenses 繝・・繝悶Ν縺ｨ縺ｯ蛻･縺ｫ縲∫匳骭ｲ繝励Ο繧ｻ繧ｹ縺ｮ迥ｶ諷九ｒ霑ｽ霍｡縺吶ｋ縲・
 *
 * CREATE TABLE registrations (
 *   id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
 *   email           TEXT NOT NULL,
 *   name            TEXT NOT NULL,
 *   company         TEXT,
 *   product_code    TEXT NOT NULL,
 *   requested_plan  TEXT NOT NULL,
 *   status          TEXT NOT NULL DEFAULT 'pending_verification',
 *   verification_token     TEXT NOT NULL,
 *   verification_expires_at TIMESTAMPTZ NOT NULL,
 *   verified_at     TIMESTAMPTZ,
 *   provisional_key TEXT,
 *   provisional_expires_at TIMESTAMPTZ,
 *   production_key  TEXT,
 *   production_expires_at  TIMESTAMPTZ,
 *   payment_method  TEXT,
 *   payment_id      TEXT,
 *   reseller_partner_id TEXT,
 *   locale          TEXT DEFAULT 'ja',
 *   created_at      TIMESTAMPTZ DEFAULT NOW(),
 *   updated_at      TIMESTAMPTZ DEFAULT NOW()
 * );
 *
 * CREATE INDEX idx_registrations_email ON registrations(email);
 * CREATE INDEX idx_registrations_token ON registrations(verification_token);
 * CREATE INDEX idx_registrations_status ON registrations(status);
 */

// =============================================================================
// 繝倥Ν繝代・髢｢謨ｰ
// =============================================================================

/**
 * 莉ｮ繧ｭ繝ｼ縺ｮ譛牙柑譛滄剞繧定ｨ育ｮ・
 */
export function getProvisionalKeyExpiry(): Date {
  const now = new Date();
  return new Date(now.getTime() + LICENSE_KEY_CONFIGS.provisional.validityDays * 24 * 60 * 60 * 1000);
}

/**
 * 豁｣蠑上く繝ｼ縺ｮ譛牙柑譛滄剞繧定ｨ育ｮ・
 */
export function getProductionKeyExpiry(): Date {
  const now = new Date();
  return new Date(now.getTime() + LICENSE_KEY_CONFIGS.production.validityDays * 24 * 60 * 60 * 1000);
}

/**
 * 隱崎ｨｼ繝医・繧ｯ繝ｳ縺ｮ譛牙柑譛滄剞繧定ｨ育ｮ・
 */
export function getVerificationTokenExpiry(): Date {
  const now = new Date();
  return new Date(now.getTime() + VERIFICATION_CONFIG.tokenExpiryDays * 24 * 60 * 60 * 1000);
}

/**
 * 陬ｽ蜩√・繝繧ｦ繝ｳ繝ｭ繝ｼ繝峨Μ繝ｳ繧ｯ繧貞叙蠕・
 */
export function getDownloadLinks(productCode: ProductCode): ProductDownloadLinks {
  return PRODUCT_DOWNLOAD_LINKS[productCode];
}

/**
 * 繝｡繝ｼ繝ｫ繝・Φ繝励Ξ繝ｼ繝医・莉ｶ蜷阪ｒ蜿門ｾ暦ｼ医・繝ｬ繝ｼ繧ｹ繝帙Ν繝繝ｼ鄂ｮ謠幢ｼ・
 */
export function getEmailSubject(
  template: EmailTemplate,
  locale: 'ja' | 'en',
  vars: Record<string, string> = {},
): string {
  let subject = EMAIL_TEMPLATES[template].subject[locale];
  for (const [key, value] of Object.entries(vars)) {
    subject = subject.replace(`{${key}}`, value);
  }
  return subject;
}

// =============================================================================
// 繧ｨ繧ｯ繧ｹ繝昴・繝・
// =============================================================================

export default {
  LICENSE_KEY_CONFIGS,
  VERIFICATION_CONFIG,
  PRODUCT_DOWNLOAD_LINKS,
  EMAIL_TEMPLATES,
  getProvisionalKeyExpiry,
  getProductionKeyExpiry,
  getVerificationTokenExpiry,
  getDownloadLinks,
  getEmailSubject,
};
