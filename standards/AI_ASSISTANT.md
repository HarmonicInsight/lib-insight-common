# AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ æ¨™æº–ä»•æ§˜

> Insight Business Suite ç³»ã‚¢ãƒ—ãƒªï¼ˆINSS/IOSH/IOSDï¼‰å…±é€šã® AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰

---

## 1. æ¦‚è¦

Insight Business Suite ç³»ã‚¢ãƒ—ãƒªã«ã¯ã€Claude API ã‚’åˆ©ç”¨ã—ãŸ AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆæ©Ÿèƒ½ã‚’æ­è¼‰ã™ã‚‹ã€‚
æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€UI ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»API é€£æºãƒ»ãƒšãƒ«ã‚½ãƒŠãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¶å¾¡ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®å…¨ä»•æ§˜ã‚’æ¨™æº–åŒ–ã™ã‚‹ã€‚

### å¯¾è±¡è£½å“

| ã‚³ãƒ¼ãƒ‰ | è£½å“å | AI ã®å½¹å‰² |
|--------|--------|-----------|
| INSS | Insight Deck Quality Gate | ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ†ã‚­ã‚¹ãƒˆã®æ ¡æ­£ãƒ»æ”¹å–„ææ¡ˆ |
| IOSH | Insight Performance Management | Excel ãƒ‡ãƒ¼ã‚¿ã®æ“ä½œãƒ»åˆ†æãƒ»æ›¸å¼è¨­å®šï¼ˆTool Useï¼‰ |
| IOSD | Insight AI Briefcase | Word ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ ¡æ­£ãƒ»è¦ç´„ãƒ»æ§‹æˆææ¡ˆ |

### è¨­è¨ˆåŸå‰‡

1. **BYOKï¼ˆBring Your Own Keyï¼‰ãƒ¢ãƒ‡ãƒ«** â€” ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªèº«ã® Claude API ã‚­ãƒ¼ã‚’å…¥åŠ›
2. **ãƒ¢ãƒ‡ãƒ«ãƒ¬ã‚¸ã‚¹ãƒˆãƒª + ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ** â€” MODEL_REGISTRY ã§ä¸€å…ƒç®¡ç†ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ã‚£ã‚¢å†…ã§ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠå¯èƒ½
3. **ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ** â€” é–‹ã„ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ AI ã«è‡ªå‹•æä¾›
4. **ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¶å¾¡** â€” å…¨ãƒ—ãƒ©ãƒ³ BYOKï¼ˆã‚¯ãƒ¬ã‚¸ãƒƒãƒˆåˆ¶é™ãªã—ï¼‰
5. **Tool Use å¯¾å¿œ** â€” ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç­‰ã§ AI ãŒãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥æ“ä½œå¯èƒ½

---

## 2. ãƒ¢ãƒ‡ãƒ«é¸æŠã‚·ã‚¹ãƒ†ãƒ 

### 2.1 ãƒ¢ãƒ‡ãƒ«ãƒ¬ã‚¸ã‚¹ãƒˆãƒª

å…¨åˆ©ç”¨å¯èƒ½ãƒ¢ãƒ‡ãƒ«ã¯ `config/ai-assistant.ts` ã® `MODEL_REGISTRY` ã§ä¸€å…ƒç®¡ç†ã™ã‚‹ã€‚
æ–°ãƒ¢ãƒ‡ãƒ«ã®ãƒªãƒªãƒ¼ã‚¹æ™‚ã¯ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«1ã‚¨ãƒ³ãƒˆãƒªè¿½åŠ ã™ã‚‹ã ã‘ã§å…¨è£½å“ã«åæ˜ ã•ã‚Œã‚‹ã€‚

```typescript
// æ–°ãƒ¢ãƒ‡ãƒ«è¿½åŠ ã®ä¾‹ï¼ˆSonnet 4.6 è¿½åŠ æ™‚ï¼‰
{
  id: 'claude-sonnet-4-6-20260210',
  family: 'sonnet',
  displayName: 'Sonnet 4.6',
  version: '4.6',
  releaseDate: '2026-02-10',
  minimumTier: 'standard',
  inputPer1M: 3,
  outputPer1M: 15,
  maxContextTokens: 200_000,
  icon: 'â­',
  status: 'active',
  isDefaultForTier: 'standard',  // â† ã“ã‚Œã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«è¨­å®š
  descriptionJa: 'æœ€æ–°ã®ä¸‡èƒ½å‹ã€‚...',
  descriptionEn: 'Latest balanced model. ...',
}
```

### 2.2 ãƒ¢ãƒ‡ãƒ«é¸æŠï¼ˆBYOK â€” ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé¸æŠï¼‰

ãƒ¢ãƒ‡ãƒ«ãƒ†ã‚£ã‚¢åˆ¶é™ã¯å»ƒæ­¢ã€‚BYOK ã®ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªèº«ã® API ã‚­ãƒ¼ã§å…¨ãƒ¢ãƒ‡ãƒ«ã‚’è‡ªç”±ã«é¸æŠå¯èƒ½ã€‚

| è¨­å®š | å†…å®¹ |
|------|------|
| ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ« | æœ€æ–° Sonnetï¼ˆ`isDefaultForTier: 'standard'`ï¼‰ |
| åˆ©ç”¨å¯èƒ½ãƒ¢ãƒ‡ãƒ« | å…¨ãƒ¢ãƒ‡ãƒ«ï¼ˆHaiku + Sonnet + Opusï¼‰â€” ãƒ†ã‚£ã‚¢åˆ¶é™ãªã— |

### 2.3 ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«é¸æŠ

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¨­å®šç”»é¢ã‹ã‚‰ã€è‡ªåˆ†ã®ãƒ†ã‚£ã‚¢å†…ã§åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã§ãã‚‹ã€‚

```typescript
// TypeScript
import { resolveModel, getAvailableModelsForTier } from '@/insight-common/config/ai-assistant';

// è¨­å®šç”»é¢: åˆ©ç”¨å¯èƒ½ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’å–å¾—
const models = getAvailableModelsForTier('standard');
// â†’ [Haiku 4.5, Sonnet 4, Sonnet 4.6]

// API ã‚³ãƒ¼ãƒ«æ™‚: ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠã‚’è€ƒæ…®ã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚’è§£æ±º
const modelId = resolveModel(balance.effectiveModelTier, userPreference);
```

```csharp
// C# (WPF)
// è¨­å®šç”»é¢: åˆ©ç”¨å¯èƒ½ãƒ¢ãƒ‡ãƒ«ä¸€è¦§ã‚’å–å¾—
var models = ClaudeModels.GetAvailableModelsForTier("standard");

// API ã‚³ãƒ¼ãƒ«æ™‚: ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠã‚’è€ƒæ…®ã—ã¦ãƒ¢ãƒ‡ãƒ«ã‚’è§£æ±º
var modelId = ClaudeModels.ResolveModel(tier, userPreferredModelId);
```

**è¨­å®šã®æ°¸ç¶šåŒ–:**

```json
// settings.json
{
  "claudeApiKey": "sk-ant-...",
  "language": "ja",
  "chatPanelWidth": 400,
  "userModelPreference": {
    "standardTierModel": "claude-sonnet-4-6-20260210",
    "premiumTierModel": null
  }
}
```

### 2.4 ãƒšãƒ«ã‚½ãƒŠã‚·ã‚¹ãƒ†ãƒ ï¼ˆå†…éƒ¨ç”¨ï¼‰

ãƒšãƒ«ã‚½ãƒŠã¯ã‚¿ã‚¹ã‚¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ¨å¥¨ã‚¨ãƒ³ã‚¸ãƒ³ã®å†…éƒ¨å®Ÿè£…ã¨ã—ã¦å­˜ç¶šã™ã‚‹ï¼ˆUIã«ã¯éå…¬é–‹ï¼‰ã€‚
å„ãƒšãƒ«ã‚½ãƒŠã®ãƒ¢ãƒ‡ãƒ«ã¯ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‹ã‚‰è‡ªå‹•è§£æ±ºã•ã‚Œã‚‹ã€‚

| ID | æ—¥æœ¬èªå | è‹±èªå | ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ãƒŸãƒªãƒ¼ | ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ | æ€§æ ¼ãƒ»ç”¨é€” |
|-----|----------|--------|----------------|-------------|-----------|
| `shunsuke` | Claude ä¿Š | Claude Shun | Haikuï¼ˆæœ€æ–°ï¼‰ | `#4696DC` | ç´ æ—©ãç°¡æ½”ã€‚è»½ã„ç¢ºèªãƒ»ã¡ã‚‡ã£ã¨ã—ãŸä¿®æ­£ã«æœ€é© |
| `megumi` | Claude æµ | Claude Megumi | Sonnetï¼ˆStandard ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ | `#B8942F` (Gold) | ä¸‡èƒ½ã§ä¸å¯§ã€‚ç·¨é›†ãƒ»è¦ç´„ãƒ»ç¿»è¨³ã®ãƒãƒ©ãƒ³ã‚¹å‹ |
| `manabu` | Claude å­¦ | Claude Manabu | Opusï¼ˆPremium ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ | `#8C64C8` | æ·±ã„æ€è€ƒåŠ›ã€‚ãƒ¬ãƒãƒ¼ãƒˆãƒ»ç²¾å¯†ãªæ–‡æ›¸ã«æœ€é© |

### 2.5 ãƒšãƒ«ã‚½ãƒŠã‚¢ã‚¤ã‚³ãƒ³

- å„ãƒšãƒ«ã‚½ãƒŠã« **32px** ãŠã‚ˆã³ **48px** ã®ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”¨æ„
- æ ¼ç´å ´æ‰€: `Assets/Personas/{id}_32.png`, `Assets/Personas/{id}_48.png`
- WPF ã®å ´åˆã¯ `NearestNeighbor` ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã§ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆã®é®®æ˜ã•ã‚’ç¶­æŒ

```xml
<!-- WPF ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° -->
<Image Source="{Binding PersonaIcon}"
       RenderOptions.BitmapScalingMode="NearestNeighbor"
       Width="32" Height="32" />
```

---

## 3. UI ãƒ‡ã‚¶ã‚¤ãƒ³æ¨™æº–

### 3.1 ãƒ‘ãƒãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¯ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã® **å³ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«** ã¨ã—ã¦é…ç½®ã™ã‚‹ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ãƒ„ãƒ¼ãƒ«ãƒãƒ¼]                                    [AI] [è¨­å®š]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚ AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ     [â‰¡]  â”‚
â”‚                                       â”‚ [ãƒšãƒ«ã‚½ãƒŠ â–¼] [âš™] [ğŸ—‘] â”‚
â”‚                                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„              â”‚                         â”‚
â”‚        ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ/              â”‚    ãƒãƒ£ãƒƒãƒˆå±¥æ­´          â”‚
â”‚         ã‚¹ãƒ©ã‚¤ãƒ‰/ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰         â”‚                         â”‚
â”‚                                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                       â”‚  â”‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸â”‚    â”‚
â”‚                                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                       â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                       â”‚  â”‚ AIå¿œç­”           â”‚    â”‚
â”‚                                       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚ [ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›     ]   â”‚
â”‚                                       â”‚ [ã‚¢ãƒ‰ãƒã‚¤ã‚¹] [ãƒã‚§ãƒƒã‚¯]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ãƒ‘ãƒãƒ«ä»•æ§˜

| é …ç›® | ä»•æ§˜ |
|------|------|
| **é…ç½®** | Grid.Column ã®æœ€çµ‚åˆ—ã€DockPanel.Right |
| **åˆæœŸçŠ¶æ…‹** | éè¡¨ç¤ºï¼ˆWidth=0ï¼‰ |
| **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå¹…** | 300px |
| **æœ€å°å¹…** | 200px |
| **ãƒªã‚µã‚¤ã‚º** | å·¦ç«¯ã« `Thumb`ï¼ˆ`Cursor="SizeWE"`ï¼‰ã§ãƒ‰ãƒ©ãƒƒã‚°ãƒªã‚µã‚¤ã‚º |
| **ãƒˆã‚°ãƒ«** | ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®ãƒ­ãƒœãƒƒãƒˆã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ã§é–‹é–‰ |

### 3.3 ãƒ˜ãƒƒãƒ€ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ãƒšãƒ«ã‚½ãƒŠ32px] AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ  [âš™][ğŸ—‘]â”‚
â”‚ [ãƒšãƒ«ã‚½ãƒŠ â–¼ ComboBox]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ã‚¿ã‚¤ãƒˆãƒ«ã€ŒAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã€ã¯ **Gold (#B8942F)** ã§è¡¨ç¤º
- ãƒšãƒ«ã‚½ãƒŠã‚¢ã‚¤ã‚³ãƒ³ï¼ˆ32px ãƒ”ã‚¯ã‚»ãƒ«ã‚¢ãƒ¼ãƒˆï¼‰ã‚’å·¦ã«é…ç½®
- ãƒšãƒ«ã‚½ãƒŠé¸æŠã¯ `ComboBox`ï¼ˆå„ãƒšãƒ«ã‚½ãƒŠã®åå‰ + èª¬æ˜ã‚’è¡¨ç¤ºï¼‰
- âš™ ãƒœã‚¿ãƒ³: API ã‚­ãƒ¼è¨­å®šãƒ‘ãƒãƒ«ã®ãƒˆã‚°ãƒ«
- ğŸ—‘ ãƒœã‚¿ãƒ³: ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã‚¯ãƒªã‚¢

### 3.4 API ã‚­ãƒ¼è¨­å®šï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Claude API Key:                      â”‚
â”‚ [PasswordBox                    ]   â”‚
â”‚ [è¨­å®š]                              â”‚
â”‚                                      â”‚
â”‚ âš  APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- API ã‚­ãƒ¼æœªè¨­å®šæ™‚ã¯è­¦å‘ŠãƒãƒŠãƒ¼ã‚’è¡¨ç¤ºï¼ˆã‚ªãƒ¬ãƒ³ã‚¸èƒŒæ™¯ï¼‰
- `PasswordBox` ã‚’ä½¿ç”¨ï¼ˆå¹³æ–‡è¡¨ç¤ºã—ãªã„ï¼‰
- è¨­å®šãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ä¿å­˜ â†’ æŠ˜ã‚ŠãŸãŸã¿ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹

### 3.5 ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

| è¦ç´  | ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ | ã‚·ã‚¹ãƒ†ãƒ  |
|------|---------|------------|---------|
| **é…ç½®** | å³å¯„ã› | å·¦å¯„ã› | ä¸­å¤® |
| **èƒŒæ™¯è‰²** | `#F5F0E8`ï¼ˆã‚¦ã‚©ãƒ¼ãƒ ï¼‰ | `#FFFFFF`ï¼ˆç™½ï¼‰ | é€æ˜ |
| **è§’ä¸¸** | 8,8,0,8 | 8,8,8,0 | 4 |
| **ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—** | `HH:mm` å³ä¸‹ | `HH:mm` å·¦ä¸‹ | ãªã— |
| **æœ€å¤§å¹…** | ãƒ‘ãƒãƒ«å¹…ã® 85% | ãƒ‘ãƒãƒ«å¹…ã® 85% | 100% |

### 3.6 å…¥åŠ›ã‚¨ãƒªã‚¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [TextBox (3è¡Œã€œ8è¡Œã®å¯å¤‰é«˜ã•)     ] â”‚
â”‚ [ã‚¢ãƒ‰ãƒã‚¤ã‚¹]        [å†…å®¹ãƒã‚§ãƒƒã‚¯]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›: `TextBox`ã€`AcceptsReturn=True`ã€æœ€å° 3 è¡Œãƒ»æœ€å¤§ 8 è¡Œ
- **ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãƒœã‚¿ãƒ³**: è‡ªç”±è³ªå•ã‚’ Claude ã«é€ä¿¡ï¼ˆå…¨è£½å“å…±é€šï¼‰
- **å†…å®¹ãƒã‚§ãƒƒã‚¯ãƒœã‚¿ãƒ³**: ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ AI ã«åˆ†æä¾é ¼ï¼ˆè£½å“å›ºæœ‰ã®æ§‹é€ åŒ–å‡ºåŠ›ï¼‰
- å‡¦ç†ä¸­ã¯ã€Œ[ãƒšãƒ«ã‚½ãƒŠã‚¢ã‚¤ã‚³ãƒ³] ãŒè€ƒãˆä¸­...ã€ã¨è¡¨ç¤ºã—ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º

### 3.7 ä½¿ç”¨é‡è¡¨ç¤ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š 3 calls | â†‘1.2K â†“3.4K | ~$0.02  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- API ã‚³ãƒ¼ãƒ«æ•°ã€å…¥åŠ›/å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã€æ¨å®šã‚³ã‚¹ãƒˆã‚’è¡¨ç¤º
- 0 ã‚³ãƒ¼ãƒ«ã®å ´åˆã¯éè¡¨ç¤º
- ã‚³ã‚¹ãƒˆè¨ˆç®—ã¯ãƒ¢ãƒ‡ãƒ«åˆ¥:
  - Haiku: $1 / $5 per 1M tokens (input/output)
  - Sonnet: $3 / $15 per 1M tokens
  - Opus: $15 / $75 per 1M tokens

---

## 4. Claude API é€£æºæ¨™æº–

### 4.1 API è¨­å®š

| é …ç›® | å€¤ |
|------|-----|
| **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ** | `https://api.anthropic.com/v1/messages` |
| **API ãƒãƒ¼ã‚¸ãƒ§ãƒ³** | `2023-06-01` |
| **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¢ãƒ‡ãƒ«** | `claude-sonnet-4-20250514` |
| **Max Tokens** | 4096 |
| **HTTP ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ** | 90 ç§’ï¼ˆHttpClientï¼‰ã€120 ç§’ï¼ˆCancellationTokenï¼‰ |
| **èªè¨¼** | `x-api-key` ãƒ˜ãƒƒãƒ€ãƒ¼ |

### 4.2 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆãƒãƒ£ãƒƒãƒˆï¼‰

```
POST https://api.anthropic.com/v1/messages
Content-Type: application/json
x-api-key: {user_api_key}
anthropic-version: 2023-06-01

{
  "model": "{selected_model}",
  "max_tokens": 4096,
  "system": "{system_prompt}",
  "messages": [
    { "role": "user", "content": "..." },
    { "role": "assistant", "content": "..." },
    ...
  ]
}
```

### 4.3 Tool Use å¯¾å¿œï¼ˆIOSH ãªã©ï¼‰

ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ“ä½œãŒå¿…è¦ãªè£½å“ã§ã¯ Tool Use ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

```json
{
  "model": "{selected_model}",
  "max_tokens": 4096,
  "system": "{system_prompt}",
  "messages": [...],
  "tools": [
    {
      "name": "get_cell_range",
      "description": "...",
      "input_schema": { ... }
    }
  ]
}
```

**Tool Use ãƒ«ãƒ¼ãƒ—ä»•æ§˜:**
- `stop_reason == "tool_use"` ã®å ´åˆã€ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œã—çµæœã‚’ `tool_result` ãƒ–ãƒ­ãƒƒã‚¯ã¨ã—ã¦é€ä¿¡
- æœ€å¤§ **10 ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³** ã§ãƒ«ãƒ¼ãƒ—ã‚’æ‰“ã¡åˆ‡ã‚Š
- ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œä¸­ã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼ˆä¾‹: ã€Œset_cell_values ã‚’å®Ÿè¡Œä¸­...ã€ï¼‰

### 4.4 ä¼šè©±å±¥æ­´ç®¡ç†

- `_conversationHistory` ãƒªã‚¹ãƒˆã§æœ€å¤§ **30 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** ã‚’ä¿æŒ
- å¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯å…ˆé ­ã‹ã‚‰å‰Šé™¤ï¼ˆsystem ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯æ¯å›å†æ§‹ç¯‰ï¼‰
- ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã« JSON å½¢å¼ã§æ°¸ç¶šåŒ–

### 4.5 å…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: AgenticSessionManager

Tool Use ãƒ«ãƒ¼ãƒ—ï¼ˆÂ§4.3ï¼‰ã¨ä¼šè©±å±¥æ­´ç®¡ç†ï¼ˆÂ§4.4ï¼‰ã¯ `InsightCommon.AI.AgenticSessionManager` ã§çµ±åˆå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã€‚
å„ã‚¢ãƒ—ãƒªã¯è£½å“å›ºæœ‰ã®ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã®ã¿ã‚’ `IToolExecutor` ã§å®Ÿè£…ã™ã‚Œã°ã‚ˆã„ã€‚

**æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«:**

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² |
|---------|------|
| `csharp/InsightCommon/AI/AgenticSessionManager.cs` | ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†æœ¬ä½“ï¼ˆãƒ«ãƒ¼ãƒ—ãƒ»å±¥æ­´ãƒ»ä½¿ç”¨é‡ï¼‰ |
| `csharp/InsightCommon/AI/IToolExecutor.cs` | ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ + å®Ÿè¡Œçµæœãƒ¢ãƒ‡ãƒ« |
| `csharp/InsightCommon/AI/ISessionCallback.cs` | UI é€šçŸ¥ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆä»»æ„å®Ÿè£…ï¼‰ |

**åŸºæœ¬çš„ãªä½¿ã„æ–¹:**

```csharp
using InsightCommon.AI;

// 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³æ§‹ç¯‰
var session = new AgenticSessionManager(claudeApiClient, new SessionOptions
{
    SystemPrompt = "ã‚ãªãŸã¯...",
    Tools = myToolDefinitions,              // Tool Use å¯¾å¿œè£½å“ã®ã¿
    ToolExecutor = new MyToolExecutor(),     // IToolExecutor å®Ÿè£…
    Callback = new MyChatPanelCallback(),    // ISessionCallback å®Ÿè£…ï¼ˆä»»æ„ï¼‰
    MaxIterations = 10,                     // Tool Use ãƒ«ãƒ¼ãƒ—ä¸Šé™
    MaxHistoryMessages = 30,                // API é€ä¿¡ç”¨å±¥æ­´ä¸Šé™
    MaxStorageMessages = 100,               // ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ç”¨å±¥æ­´ä¸Šé™
});

// 2. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆTool Use ãƒ«ãƒ¼ãƒ—ã¯å†…éƒ¨ã§è‡ªå‹•å‡¦ç†ï¼‰
var response = await session.SendAsync("A1:C10ã‚’åˆè¨ˆã—ã¦", cancellationToken);
// response.Text       â†’ AI ã®æœ€çµ‚ãƒ†ã‚­ã‚¹ãƒˆå¿œç­”
// response.Iterations â†’ API ã‚³ãƒ¼ãƒ«å›æ•°ï¼ˆãƒ«ãƒ¼ãƒ—å«ã‚€ï¼‰
// response.WasTruncated â†’ MaxIterations åˆ°é”ã§æ‰“ã¡åˆ‡ã‚‰ã‚ŒãŸå ´åˆ true

// 3. ä½¿ç”¨é‡ç¢ºèª
var usage = session.Usage;
// usage.TotalCalls, usage.TotalInputTokens, usage.TotalOutputTokens, usage.EstimatedCostUsd

// 4. ã‚»ãƒƒã‚·ãƒ§ãƒ³æ°¸ç¶šåŒ–ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜æ™‚ï¼‰
ChatSession exported = session.ExportSession();

// 5. ã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼æ™‚ï¼‰
session.ImportSession(existingChatSession);
```

**IToolExecutor ã®å®Ÿè£…ä¾‹ï¼ˆIOSHï¼‰:**

```csharp
public class SpreadsheetToolExecutor : IToolExecutor
{
    private readonly SpreadsheetControl _control;

    public SpreadsheetToolExecutor(SpreadsheetControl control)
    {
        _control = control;
    }

    public async Task<ToolExecutionResult> ExecuteAsync(
        string toolName, JsonElement input, CancellationToken ct)
    {
        return toolName switch
        {
            "get_cell_range" => await GetCellRange(input),
            "set_cell_values" => await SetCellValues(input),
            _ => new ToolExecutionResult
            {
                Content = $"Unknown tool: {toolName}",
                IsError = true,
            },
        };
    }
}
```

**å®šæ•°ã®æ ¹æ‹ :**

| å®šæ•° | å€¤ | æ ¹æ‹  |
|------|-----|------|
| `MaxIterations` | 10 | Â§4.3 Tool Use ãƒ«ãƒ¼ãƒ—æœ€å¤§ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |
| `MaxHistoryMessages` | 30 | Â§4.4 API é€ä¿¡ç”¨æœ€å¤§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•° |
| `MaxStorageMessages` | 100 | Â§10.4 ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜æœ€å¤§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•° |

### 4.6 AI ãƒ¡ãƒ¢ãƒªã‚·ã‚¹ãƒ†ãƒ 

AgenticSessionManager ã¯ AI ãƒ¡ãƒ¢ãƒªã‚·ã‚¹ãƒ†ãƒ ã‚’çµ±åˆã—ã¦ãŠã‚Šã€ä¼šè©±ã‹ã‚‰ç”¨èªãƒ»äººç‰©ãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã‚’è‡ªå‹•æŠ½å‡ºã—ã€æ¬¡å›ä»¥é™ã® system prompt ã«æ³¨å…¥ã™ã‚‹ã€‚

**è¨­è¨ˆæ–¹é‡: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æŠ½å‡ºï¼ˆè¿½åŠ  API ã‚³ã‚¹ãƒˆ ã‚¼ãƒ­ï¼‰**

é€šå¸¸ã®å¿œç­”ã®ä¸­ã§ `<ai_memory>` ã‚¿ã‚°ã¨ã—ã¦ãƒ¡ãƒ¢ãƒªæŠ½å‡ºã‚’è¡Œã†ãŸã‚ã€è¿½åŠ ã® API å‘¼ã³å‡ºã—ã¯ç™ºç”Ÿã—ãªã„ã€‚system prompt ã« ~200 ãƒˆãƒ¼ã‚¯ãƒ³ã®æŠ½å‡ºæŒ‡ç¤ºãŒåŠ ã‚ã‚‹ã®ã¿ã€‚

**æ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«:**

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² |
|---------|------|
| `csharp/InsightCommon/AI/AiMemoryModels.cs` | ãƒ¡ãƒ¢ãƒªã‚¨ãƒ³ãƒˆãƒªå‹ãƒ»ãƒ›ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ãƒ—ãƒ©ãƒ³åˆ¥åˆ¶é™ |
| `csharp/InsightCommon/AI/MemoryExtractor.cs` | ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³æŠ½å‡ºãƒ»ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ•´å½¢ãƒ»æŠ½å‡ºæŒ‡ç¤ºç”Ÿæˆ |
| `config/ai-memory.ts` | TypeScript å‹å®šç¾©ï¼ˆC# ãƒ¢ãƒ‡ãƒ«ã®æ ¹æ‹ ï¼‰ |

**ä½¿ã„æ–¹:**

```csharp
using InsightCommon.AI;

// 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ›ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’èª­ã¿è¾¼ã¿
var hotCache = projectFile.LoadAiMemory(); // ZIP å†… ai_memory.json

// 2. SessionOptions ã«ãƒ›ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¸¡ã™
var session = new AgenticSessionManager(client, new SessionOptions
{
    SystemPrompt = basePrompt,
    MemoryHotCache = hotCache,   // â† ãƒ¡ãƒ¢ãƒªæ³¨å…¥
    Locale = "ja",               // â† æŠ½å‡ºæŒ‡ç¤ºãƒ»æ•´å½¢ã®è¨€èª
    Callback = new MyChatPanelCallback(),
});

// 3. å¿œç­”ã‹ã‚‰ãƒ¡ãƒ¢ãƒªãŒè‡ªå‹•æŠ½å‡ºã•ã‚Œã‚‹
var response = await session.SendAsync("ç”°ä¸­éƒ¨é•·ã®KPIå ±å‘Šæ›¸ã‚’ä¿®æ­£ã—ã¦", ct);
// response.Text             â†’ ã‚¯ãƒªãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ<ai_memory> ã‚¿ã‚°é™¤å»æ¸ˆã¿ï¼‰
// response.ExtractedMemories â†’ [PersonEntry("ç”°ä¸­", éƒ¨é•·), GlossaryEntry("KPI", ...)]

// 4. ISessionCallback.OnMemoryExtracted() ã§ãƒ¡ãƒ¢ãƒªãƒ‘ãƒãƒ« UI ã‚’æ›´æ–°
//    ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªå¾Œã€ãƒ›ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ â†’ æ¬¡å› system prompt ã«è‡ªå‹•æ³¨å…¥
```

**ãƒ—ãƒ©ãƒ³åˆ¥åˆ¶é™ï¼ˆ`AiMemoryLimitsRegistry`ï¼‰:**

| ãƒ—ãƒ©ãƒ³ | ãƒ›ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¸Šé™ | ãƒ‡ã‚£ãƒ¼ãƒ—ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šé™ |
|--------|:------------------:|:--------------------:|
| TRIAL | 50 | 200 |
| STD | 20 | ç„¡åŠ¹ |
| PRO | 100 | 500 |
| ENT | ç„¡åˆ¶é™ | ç„¡åˆ¶é™ |

**ãƒ¡ãƒ¢ãƒªæŠ½å‡ºãƒ•ãƒ­ãƒ¼:**

```
Claude å¿œç­” â†’ MemoryExtractor.Extract()
  â”œâ”€ CleanText    â†’ AgenticResponse.Textï¼ˆè¡¨ç¤ºç”¨ï¼‰
  â”œâ”€ Entries      â†’ AgenticResponse.ExtractedMemories
  â””â”€ Callback     â†’ ISessionCallback.OnMemoryExtracted()
                     â†’ ã‚¢ãƒ—ãƒªå´ã§ UI è¡¨ç¤ºãƒ»ç¢ºèªãƒ»ä¿å­˜
```

---

## 5. ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ¨™æº–

### 5.1 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹æˆ

ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ä»¥ä¸‹ã®æ§‹æˆã§çµ„ã¿ç«‹ã¦ã‚‹:

```
[1. ãƒ­ãƒ¼ãƒ«å®šç¾©]
[2. å¿œç­”ãƒ«ãƒ¼ãƒ«]
[3. è£½å“å›ºæœ‰ã®æ©Ÿèƒ½èª¬æ˜]
[4. é–‹ã„ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆå‹•çš„ï¼‰]
[5. ãƒ¡ãƒ¢ãƒªæŠ½å‡ºæŒ‡ç¤ºï¼ˆÂ§4.6 â€” è‡ªå‹•è¿½åŠ ï¼‰]
[6. è“„ç©ãƒ¡ãƒ¢ãƒªï¼ˆÂ§4.6 â€” ãƒ›ãƒƒãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰è‡ªå‹•æ³¨å…¥ï¼‰]
```

### 5.2 å…±é€šãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

```
ã‚ãªãŸã¯{è£½å“å}ã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚„è¦æœ›ã«ä¸å¯§ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨åŒã˜è¨€èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚
```

### 5.3 è£½å“åˆ¥ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

#### Insight Deck Quality Gate (INSS)

```
ã‚ãªãŸã¯PowerPointãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®å†…å®¹ã‚’åˆ†æãƒ»ä¿®æ­£ã™ã‚‹AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚
æ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚

ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ã®å„è¡Œã«ã¯è¡Œç•ªå·ï¼ˆrow=Nï¼‰ãŒä»˜ã„ã¦ã„ã¾ã™ã€‚
ç‰¹å®šã®è¡Œã«ã¤ã„ã¦è¨€åŠã™ã‚‹ã¨ãã¯ã€Œ#Nã€ã®å½¢å¼ã§è¡Œç•ªå·ã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œ#5ã‚’ä¿®æ­£ã—ã¦ã€ã®ã‚ˆã†ã«è¡Œç•ªå·ã§æŒ‡å®šã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ä¸»ãªæ©Ÿèƒ½ï¼š
- ãƒ†ã‚­ã‚¹ãƒˆã®èª¤å­—è„±å­—ã®æŒ‡æ‘˜ã¨ä¿®æ­£
- æ–‡ç« ã®æ”¹å–„ææ¡ˆ
- è¡¨ç¾ã®çµ±ä¸€
- å†…å®¹ã®è¦ç´„
- ã‚¹ãƒ©ã‚¤ãƒ‰æ§‹æˆã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚„è¦æœ›ã«ä¸å¯§ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚
```

#### Insight Performance Management (IOSH)

```
You are an AI assistant for Insight Performance Management, an Excel version control application.
You have tools to read and write the currently open spreadsheet.
Use tools to fulfill user requests about modifying, analyzing, or formatting data.
Always explain what you are doing before and after using tools.
Respond in the same language as the user's message.
```

#### Insight AI Briefcase (IOSD)

```
ã‚ãªãŸã¯Insight AI Briefcaseã®AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚Wordãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ“ä½œãƒ»è‡ªå‹•åŒ–ã‚’æ”¯æ´ã—ã¾ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨åŒã˜è¨€èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚

ä¸»ãªæ©Ÿèƒ½ï¼š
- æ–‡ç« ã®æ ¡æ­£ãƒ»èª¤å­—è„±å­—ã®ä¿®æ­£
- æ–‡æ›¸ã®è¦ç´„ãƒ»æ§‹æˆææ¡ˆ
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ´»ç”¨ã®ææ¡ˆ

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚„è¦æœ›ã«ä¸å¯§ã«å›ç­”ã—ã¦ãã ã•ã„ã€‚
```

### 5.4 ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®æ³¨å…¥

ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æœ«å°¾ã«ã€é–‹ã„ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’å‹•çš„ã«è¿½åŠ ã™ã‚‹ã€‚

**ã‚¹ãƒ©ã‚¤ãƒ‰ç³»ï¼ˆINSSï¼‰:**
```
ç¾åœ¨é–‹ã„ã¦ã„ã‚‹PowerPointã®å†…å®¹ï¼š
=== ã‚¹ãƒ©ã‚¤ãƒ‰ 1 ===
row=1, slideNumber=1, shapeId="Title1", text="ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¿ã‚¤ãƒˆãƒ«"
row=2, slideNumber=1, shapeId="Body1", text="æœ¬æ–‡ãƒ†ã‚­ã‚¹ãƒˆ"
```

**ã‚·ãƒ¼ãƒˆç³»ï¼ˆIOSHï¼‰:**
```
ç¾åœ¨ã®ãƒ¯ãƒ¼ã‚¯ãƒ–ãƒƒã‚¯æƒ…å ±:
- ãƒ•ã‚¡ã‚¤ãƒ«å: example.xlsx
- ã‚·ãƒ¼ãƒˆæ•°: 3

Sheet1 (100è¡Œ x 20åˆ—):
A	B	C	...
å£²ä¸Š	1000	...
```

- ã‚¹ãƒ©ã‚¤ãƒ‰ç³»: å…¨ã‚¹ãƒ©ã‚¤ãƒ‰ã®å…¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ `row=N` å½¢å¼ã§ä»˜ä¸
- ã‚·ãƒ¼ãƒˆç³»: å„ã‚·ãƒ¼ãƒˆã®å…ˆé ­ 50 è¡Œ x 20 åˆ—ã‚’ã‚¿ãƒ–åŒºåˆ‡ã‚Šã§ä»˜ä¸ï¼ˆè¶…éæ™‚ã¯åˆ‡ã‚Šè©°ã‚é€šçŸ¥ï¼‰

---

## 6. æ§‹é€ åŒ–å‡ºåŠ›ï¼ˆå†…å®¹ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ï¼‰

### 6.1 ãƒ†ã‚­ã‚¹ãƒˆä¿®æ­£ææ¡ˆï¼ˆã‚¹ãƒ©ã‚¤ãƒ‰ç³»ï¼‰

ã€Œå†…å®¹ãƒã‚§ãƒƒã‚¯ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã«ä½¿ç”¨ã™ã‚‹å°‚ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:

```
ã‚ãªãŸã¯PowerPointãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆä¿®æ­£ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚

ã€é‡è¦ãªãƒ«ãƒ¼ãƒ«ã€‘
- å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®å„è¡Œã¯ rowï¼ˆè¡Œç•ªå·ï¼‰, slideNumber, shapeId, text ã®æ§‹é€ ã‚’æŒã¡ã¾ã™ã€‚
- ä¿®æ­£ææ¡ˆã§ã¯ rowï¼ˆè¡Œç•ªå·ï¼‰ã‚’å¿…ãšè¿”ã—ã¦ãã ã•ã„ã€‚ã“ã‚ŒãŒæœ€ã‚‚é‡è¦ãªè­˜åˆ¥å­ã§ã™ã€‚
- originalText ã«ã¯ã€å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã® text ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å†…å®¹ã‚’ã€Œå®Œå…¨ä¸€è‡´ã€ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚
- suggestedText ã«ã¯ã€ä¿®æ­£å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆå…¨æ–‡ã‚’æ›¸ã„ã¦ãã ã•ã„ï¼ˆå¤‰æ›´ç®‡æ‰€ã ã‘ã§ãªãå…¨æ–‡ï¼‰ã€‚

ä¿®æ­£ææ¡ˆã¯å¿…ãšä»¥ä¸‹ã®JSONé…åˆ—å½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ï¼š
[{"row": 1, "originalText": "...", "suggestedText": "...", "reason": "..."}]
```

### 6.2 ææ¡ˆã®é©ç”¨ãƒ•ãƒ­ãƒ¼

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œå†…å®¹ãƒã‚§ãƒƒã‚¯ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’ Claude ã«é€ä¿¡ï¼ˆæ§‹é€ åŒ–å‡ºåŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰
3. Claude ãŒ JSON é…åˆ—ã®ä¿®æ­£ææ¡ˆã‚’è¿”å´
4. `row` ç•ªå·ã§å¯¾è±¡ã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒãƒƒãƒãƒ³ã‚°ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: `originalText` å®Œå…¨ä¸€è‡´ï¼‰
5. ãƒãƒƒãƒã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã« `AiSuggestedText` ã‚’è¨­å®šã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ `AiSuggested` ã«å¤‰æ›´
6. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒææ¡ˆã‚’é¸æŠã—ã€Œåæ˜ ã€ãƒœã‚¿ãƒ³ã§é©ç”¨
7. Undo ã‚¹ã‚¿ãƒƒã‚¯ã«è¨˜éŒ²ï¼ˆ`UndoType.AiApply`ï¼‰

---

## 7. Tool Use å®šç¾©ï¼ˆIOSH æ¨™æº–ï¼‰

Insight Performance Management ã§åˆ©ç”¨ã™ã‚‹ 6 ã¤ã®æ¨™æº–ãƒ„ãƒ¼ãƒ«:

### 7.1 ãƒ„ãƒ¼ãƒ«ä¸€è¦§

| ãƒ„ãƒ¼ãƒ«å | èª¬æ˜ | ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ |
|---------|------|-----------|
| `get_cell_range` | ã‚»ãƒ«ç¯„å›²ã®å€¤ãƒ»æ•°å¼ãƒ»ã‚¹ã‚¿ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Š | `range` (A1å½¢å¼), `sheet_name?` |
| `set_cell_values` | ã‚»ãƒ«ã«ãƒ†ã‚­ã‚¹ãƒˆ/æ•°å€¤ã‚’è¨­å®š | `updates[]` (cell, value), `sheet_name?` |
| `set_cell_formulas` | ã‚»ãƒ«ã«æ•°å¼ã‚’è¨­å®š | `updates[]` (cell, formula), `sheet_name?` |
| `set_cell_styles` | ã‚»ãƒ«ã®æ›¸å¼ã‚’è¨­å®š | `updates[]` (range, style), `sheet_name?` |
| `analyze_data` | æ•°å€¤ãƒ‡ãƒ¼ã‚¿ã®çµ±è¨ˆã‚µãƒãƒªãƒ¼ | `range`, `sheet_name?` |
| `find_cells` | ãƒ†ã‚­ã‚¹ãƒˆ/æ•°å¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ¤œç´¢ | `search_text`, `search_in?`, `sheet_name?` |

### 7.2 å®‰å…¨åˆ¶é™

| é …ç›® | åˆ¶é™å€¤ |
|------|--------|
| `get_cell_range` æœ€å¤§èª­ã¿å–ã‚Š | 200 è¡Œ x 50 åˆ— |
| `find_cells` æœ€å¤§çµæœæ•° | 50 ä»¶ |
| Tool Use ãƒ«ãƒ¼ãƒ—æœ€å¤§ | 10 ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |
| å…¨ãƒ„ãƒ¼ãƒ«ã® `sheet_name` | çœç•¥æ™‚ã¯ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚·ãƒ¼ãƒˆ |

### 7.3 ä»–è£½å“ã¸ã® Tool Use æ‹¡å¼µ

IOSDï¼ˆWord æ“ä½œï¼‰å‘ã‘ã«ã€ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã‚’å°†æ¥è¿½åŠ äºˆå®š:

| ãƒ„ãƒ¼ãƒ«å | èª¬æ˜ |
|---------|------|
| `get_paragraphs` | æ®µè½ãƒ†ã‚­ã‚¹ãƒˆã®èª­ã¿å–ã‚Š |
| `set_paragraph_text` | æ®µè½ãƒ†ã‚­ã‚¹ãƒˆã®æ›¸ãæ›ãˆ |
| `get_document_structure` | è¦‹å‡ºã—æ§‹é€ ã®å–å¾— |
| `find_text` | ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ |

---

## 8. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹åˆ¶å¾¡

### 8.1 æ©Ÿèƒ½ã‚­ãƒ¼

å…¨è£½å“å…±é€šã§ `ai_assistant` ã‚­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

```typescript
// config/products.ts
{
  key: 'ai_assistant',
  name: 'AI Assistant',
  nameJa: 'AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ',
  type: 'boolean',
  allowedPlans: ['TRIAL', 'STD', 'PRO', 'ENT'],
  descriptionJa: 'AIãƒãƒ£ãƒƒãƒˆã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œæ”¯æ´',
}
```

### 8.2 ãƒ—ãƒ©ãƒ³åˆ¥ã‚¢ã‚¯ã‚»ã‚¹

| ãƒ—ãƒ©ãƒ³ | AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ | ç†ç”± |
|--------|:----------:|------|
| TRIAL | âœ…ï¼ˆç„¡åˆ¶é™ãƒ»BYOKï¼‰ | å…¨æ©Ÿèƒ½è©•ä¾¡ã®ãŸã‚ |
| STD | âœ…ï¼ˆç„¡åˆ¶é™ãƒ»BYOKï¼‰ | BYOK â€” ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã® API ã‚­ãƒ¼ã§åˆ©ç”¨ |
| PRO | âœ…ï¼ˆç„¡åˆ¶é™ãƒ»BYOKï¼‰ | BYOK â€” ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã® API ã‚­ãƒ¼ã§åˆ©ç”¨ |
| ENT | âœ…ï¼ˆç„¡åˆ¶é™ãƒ»BYOKï¼‰ | BYOK â€” ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã® API ã‚­ãƒ¼ã§åˆ©ç”¨ |

### 8.3 ã‚²ãƒ¼ãƒˆå®Ÿè£…

**C# (WPF):**

```csharp
// ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã® AI ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚
private void AiToggle_Click(object sender, RoutedEventArgs e)
{
    if (!_licenseManager.CurrentLicense.Plan.HasAiFeature())
    {
        ShowUpgradePrompt("AI_ProRequired");
        return;
    }
    viewModel.ChatVM.ToggleChatCommand.Execute(null);
}

// PlanCode æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰
public static bool HasAiFeature(this PlanCode plan) =>
    plan is PlanCode.Free or PlanCode.Trial or PlanCode.Pro or PlanCode.Ent;
```

**TypeScript:**

```typescript
import { checkFeature } from '@/insight-common/config/products';

if (!checkFeature(productCode, 'ai_assistant', userPlan)) {
  showUpgradeDialog('AI_ProRequired');
  return;
}
```

### 8.4 ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ€ã‚¤ã‚¢ãƒ­ã‚°

AI ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã« STD ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤ºã™ã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã¯PROãƒ—ãƒ©ãƒ³ã®æ©Ÿèƒ½ã§ã™      â”‚
â”‚                                        â”‚
â”‚  AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ã€           â”‚
â”‚  PROãƒ—ãƒ©ãƒ³ä»¥ä¸Šã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãŒ        â”‚
â”‚  å¿…è¦ã§ã™ã€‚                             â”‚
â”‚                                        â”‚
â”‚  [ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰]         [é–‰ã˜ã‚‹]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 9.1 ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

**C#:**

```csharp
public class AiMessage
{
    public string Id { get; set; } = Guid.NewGuid().ToString("N")[..8];
    public string Content { get; set; } = string.Empty;
    public AiMessageRole Role { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.Now;
    public bool IsStreaming { get; set; }
    public bool IsToolStatus { get; set; }
    public string DisplayTime => CreatedAt.ToString("HH:mm");
}

public enum AiMessageRole
{
    User,
    Assistant,
    System
}
```

**TypeScript:**

```typescript
interface AiMessage {
  id: string;
  content: string;
  role: 'user' | 'assistant' | 'system';
  createdAt: Date;
  isStreaming?: boolean;
  isToolStatus?: boolean;
}
```

### 9.2 ãƒšãƒ«ã‚½ãƒŠ

```csharp
public class AiPersona
{
    public string Id { get; set; }          // "shunsuke" | "megumi" | "manabu"
    public string NameJa { get; set; }      // "Claudeä¿Š"
    public string NameEn { get; set; }      // "Claude Shun"
    public string Model { get; set; }       // "claude-haiku-4-5-20251001"
    public string ThemeColor { get; set; }  // "#4696DC"
    public string DescriptionJa { get; set; }
    public string DescriptionEn { get; set; }
    public string Icon32Path { get; set; }
    public string Icon48Path { get; set; }
}
```

### 9.3 ãƒ†ã‚­ã‚¹ãƒˆä¿®æ­£ææ¡ˆ

```csharp
public class TextSuggestion
{
    public int Row { get; set; }
    public int SlideNumber { get; set; }
    public string ShapeId { get; set; }
    public string OriginalText { get; set; }
    public string SuggestedText { get; set; }
    public string Reason { get; set; }
}
```

### 9.4 Tool Use é–¢é€£

```csharp
public class ToolDefinition
{
    public string Name { get; set; } = "";
    public string Description { get; set; } = "";
    public JsonObject InputSchema { get; set; } = new();
}

public class ContentBlock
{
    public string Type { get; set; } = "";      // "text" | "tool_use"
    public string? Text { get; set; }
    public string? Id { get; set; }             // tool_use ID
    public string? Name { get; set; }           // tool name
    public JsonElement? Input { get; set; }
}

public class ClaudeResponse
{
    public List<ContentBlock> Content { get; set; } = new();
    public string StopReason { get; set; } = "";
    public int InputTokens { get; set; }
    public int OutputTokens { get; set; }
}

public class ToolResultBlock
{
    public string ToolUseId { get; set; } = "";
    public string Content { get; set; } = "";
    public bool? IsError { get; set; }
}
```

---

## 10. æ°¸ç¶šåŒ–

### 10.1 ä¿å­˜å…ˆ

- **Windows (WPF):** `%LOCALAPPDATA%\HarmonicInsight\{ProductName}\`
- **Web (React):** `localStorage` / `AsyncStorage` (React Native)

### 10.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---------|------|
| `settings.json` | API ã‚­ãƒ¼ã€é¸æŠãƒ¢ãƒ‡ãƒ«ã€ãƒšãƒ«ã‚½ãƒŠã€è¨€èªè¨­å®š |
| `chat_history.json` | ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ |

### 10.3 è¨­å®šã‚¹ã‚­ãƒ¼ãƒ

```json
{
  "claudeApiKey": "sk-ant-...",
  "selectedPersonaId": "megumi",
  "selectedModel": "claude-sonnet-4-6-20260210",
  "language": "ja",
  "chatPanelWidth": 400,
  "userModelPreference": {
    "standardTierModel": "claude-sonnet-4-6-20260210",
    "premiumTierModel": null
  }
}
```

### 10.4 ãƒãƒ£ãƒƒãƒˆå±¥æ­´ç®¡ç†

- èµ·å‹•æ™‚ã« `chat_history.json` ã‚’èª­ã¿è¾¼ã¿
- AI å¿œç­”ã®ãŸã³ã«ä¿å­˜
- ãƒãƒ£ãƒƒãƒˆã‚¯ãƒªã‚¢ã§ç©ºé…åˆ—ã«ä¸Šæ›¸ã
- æœ€å¤§ 100 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿æŒï¼ˆè¶…éåˆ†ã¯å¤ã„é †ã«å‰Šé™¤ï¼‰

---

## 11. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 11.1 API ã‚¨ãƒ©ãƒ¼

| HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | è¡¨ç¤ºãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | å¯¾å¿œ |
|:---:|---------|------|
| 401 | API ã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ | API ã‚­ãƒ¼è¨­å®šãƒ‘ãƒãƒ«ã‚’é–‹ã |
| 429 | ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸Šé™ã«é”ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚ | `Retry-After` ãƒ˜ãƒƒãƒ€ãƒ¼ã«å¾“ã† |
| 500+ | ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚ | ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | å¿œç­”ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚ | ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‡¦ç†æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ |

### 11.2 ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ `AiMessageRole.System` ã¨ã—ã¦ãƒãƒ£ãƒƒãƒˆå†…ã«è¡¨ç¤ºã™ã‚‹ã€‚èƒŒæ™¯è‰²ã¯é€æ˜ã€ãƒ†ã‚­ã‚¹ãƒˆã¯ `TextSecondaryColor (#57534E)`ã€‚

---

## 12. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å¿…é ˆï¼ˆå…¨è£½å“ï¼‰

- [ ] ãƒšãƒ«ã‚½ãƒŠã‚·ã‚¹ãƒ†ãƒ ï¼ˆ3 ãƒšãƒ«ã‚½ãƒŠ: shunsuke / megumi / manabuï¼‰
- [ ] ãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ« UIï¼ˆå³ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ«ã€ãƒªã‚µã‚¤ã‚ºå¯èƒ½ï¼‰
- [ ] ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆGold ã‚¿ã‚¤ãƒˆãƒ«ã€ãƒšãƒ«ã‚½ãƒŠé¸æŠã€è¨­å®šã€ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ï¼‰
- [ ] API ã‚­ãƒ¼è¨­å®šãƒ‘ãƒãƒ«ï¼ˆPasswordBoxã€æœªè¨­å®šè­¦å‘Šï¼‰
- [ ] ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å³å¯„ã›ã€AI å·¦å¯„ã›ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰
- [ ] å…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆå¯å¤‰é«˜ã• TextBoxã€ã‚¢ãƒ‰ãƒã‚¤ã‚¹/ãƒã‚§ãƒƒã‚¯ãƒœã‚¿ãƒ³ï¼‰
- [ ] å‡¦ç†ä¸­ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ï¼ˆãƒšãƒ«ã‚½ãƒŠã‚¢ã‚¤ã‚³ãƒ³ + ã€ŒãŒè€ƒãˆä¸­...ã€ï¼‰
- [ ] ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ©Ÿèƒ½ï¼ˆCancellationTokenï¼‰
- [ ] ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚²ãƒ¼ãƒˆï¼ˆå…¨ãƒ—ãƒ©ãƒ³ BYOKãƒ»ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆåˆ¶é™ãªã—ï¼‰
- [ ] ãƒãƒ£ãƒƒãƒˆå±¥æ­´æ°¸ç¶šåŒ–ï¼ˆJSON ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
- [ ] è¨­å®šæ°¸ç¶šåŒ–ï¼ˆAPI ã‚­ãƒ¼ã€ãƒšãƒ«ã‚½ãƒŠã€ãƒ¢ãƒ‡ãƒ«ï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆ401 / 429 / 500 / ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ³¨å…¥ï¼ˆé–‹ã„ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ system ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å«ã‚ã‚‹ï¼‰

### è£½å“å›ºæœ‰

**ã‚¹ãƒ©ã‚¤ãƒ‰ç³»ï¼ˆINSSï¼‰:**
- [ ] æ§‹é€ åŒ–å‡ºåŠ›ï¼ˆå†…å®¹ãƒã‚§ãƒƒã‚¯ â†’ JSON ä¿®æ­£ææ¡ˆï¼‰
- [ ] ææ¡ˆã® `row` ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒãƒ³ã‚°
- [ ] ææ¡ˆã®é¸æŠãƒ»ä¸€æ‹¬åæ˜ ãƒ»Undo

**ã‚·ãƒ¼ãƒˆç³»ï¼ˆIOSHï¼‰:**
- [ ] Tool Use å¯¾å¿œï¼ˆ6 ãƒ„ãƒ¼ãƒ«å®šç¾©ï¼‰
- [ ] Tool Use ãƒ«ãƒ¼ãƒ—ï¼ˆæœ€å¤§ 10 ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- [ ] ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
- [ ] ä½¿ç”¨é‡ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ï¼ˆã‚³ãƒ¼ãƒ«æ•°ã€ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã€æ¨å®šã‚³ã‚¹ãƒˆï¼‰
- [ ] Syncfusion SfSpreadsheet ã¨ã®é€£æºï¼ˆDispatcher çµŒç”±ï¼‰

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç³»ï¼ˆIOSDï¼‰:**
- [ ] å°†æ¥ã® Tool Use å¯¾å¿œæº–å‚™ï¼ˆget_paragraphs ç­‰ï¼‰

---

## 13. ç¦æ­¢äº‹é …

| âŒ ã‚„ã£ã¦ã¯ã„ã‘ãªã„ | âœ… æ­£ã—ã„ã‚„ã‚Šæ–¹ |
|-------------------|---------------|
| OpenAI / Azure API ã‚’ä½¿ç”¨ | **Claude (Anthropic) API** ã‚’ä½¿ç”¨ |
| API ã‚­ãƒ¼ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ | ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ› + ãƒ­ãƒ¼ã‚«ãƒ«æš—å·åŒ–ä¿å­˜ |
| API ã‚­ãƒ¼ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ç›´æ¥ Anthropic API ã¸ |
| ç‹¬è‡ªã®ãƒšãƒ«ã‚½ãƒŠå®šç¾© | æ¨™æº– 3 ãƒšãƒ«ã‚½ãƒŠï¼ˆshunsuke / megumi / manabuï¼‰ã‚’ä½¿ç”¨ |
| ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’çœç•¥ | `checkFeature(product, 'ai_assistant', plan)` ã‚’å¿…ãšå®Ÿè¡Œ |
| é’è‰²ã§ãƒãƒ£ãƒƒãƒˆãƒãƒ–ãƒ«ã‚’è¡¨ç¤º | **ã‚¦ã‚©ãƒ¼ãƒ ç³»ã®è‰²** ã‚’ä½¿ç”¨ï¼ˆ`#F5F0E8` ç­‰ï¼‰ |
| ç„¡åˆ¶é™ã®ä¼šè©±å±¥æ­´ | **30 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸** ã§ API é€ä¿¡å±¥æ­´ã‚’åˆ¶é™ |
