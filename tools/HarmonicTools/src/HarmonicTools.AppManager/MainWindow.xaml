<Window x:Class="HarmonicTools.AppManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Harmonic App Manager"
        Icon="Assets/app.ico"
        Width="1100" Height="750"
        MinWidth="900" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResize">
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0"
                      ResizeBorderThickness="6"
                      GlassFrameThickness="0"
                      CornerRadius="8"/>
    </WindowChrome.WindowChrome>
    <Border Background="{StaticResource BgPrimaryBrush}"
            BorderBrush="{StaticResource BorderBrush}"
            BorderThickness="1"
            CornerRadius="8">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="48"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Border Grid.Row="0" Background="{StaticResource BgSecondaryBrush}"
                    CornerRadius="8,8,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0,0,0">
                        <Image Source="Assets/app.ico" Width="20" Height="20" Margin="0,0,8,0" RenderOptions.BitmapScalingMode="HighQuality" />
                        <TextBlock Text="Harmonic App Manager"
                                   FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI"
                                   FontSize="15" FontWeight="SemiBold"
                                   Foreground="{StaticResource PrimaryBrush}"
                                   VerticalAlignment="Center"/>
                        <TextBlock Text="v1.0"
                                   FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI"
                                   FontSize="11"
                                   Foreground="{StaticResource TextTertiaryBrush}"
                                   VerticalAlignment="Center" Margin="8,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,8,0">
                        <Button Content="─" Click="Minimize_Click" Width="36" Height="36"
                                Background="Transparent" BorderThickness="0" FontSize="14"
                                Foreground="{StaticResource TextSecondaryBrush}" Cursor="Hand"/>
                        <Button Content="□" Click="Maximize_Click" Width="36" Height="36"
                                Background="Transparent" BorderThickness="0" FontSize="14"
                                Foreground="{StaticResource TextSecondaryBrush}" Cursor="Hand"/>
                        <Button x:Name="CloseBtn" Content="✕" Click="Close_Click" Width="36" Height="36"
                                Background="Transparent" BorderThickness="0" FontSize="12"
                                Foreground="{StaticResource TextSecondaryBrush}" Cursor="Hand"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content -->
            <Grid Grid.Row="1" Margin="16">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="280" MinWidth="180" MaxWidth="500"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Panel: App List -->
                <Border Grid.Column="0" Background="{StaticResource BgCardBrush}"
                        BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                        CornerRadius="8" Margin="0,0,0,0" Padding="12">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="管理アプリ一覧"
                                   FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI"
                                   FontSize="13" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}" Margin="0,0,0,8"/>

                        <!-- App List -->
                        <ListBox x:Name="AppListBox" Grid.Row="1"
                                 Background="Transparent" BorderThickness="0"
                                 SelectionChanged="AppListBox_SelectionChanged"
                                 FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="4,6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}"
                                                       FontSize="13" FontWeight="SemiBold"
                                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock Text="{Binding Description}"
                                                       FontSize="11"
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                        </StackPanel>
                                        <TextBlock x:Name="StatusIcon" Grid.Column="1"
                                                   Text="{Binding StatusIcon}"
                                                   FontSize="11" VerticalAlignment="Center"
                                                   FontFamily="Segoe UI Variable, Segoe UI"
                                                   Foreground="{StaticResource TextTertiaryBrush}"
                                                   Margin="4,0,0,0"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>

                        <!-- Add/Remove buttons -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,8,0,0">
                            <Button Content="追加" Style="{StaticResource SecondaryButton}"
                                    Padding="12,4" Click="AddApp_Click"/>
                            <Button Content="削除" Style="{StaticResource DangerButton}"
                                    Padding="12,4" Margin="8,0,0,0" Click="RemoveApp_Click"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- GridSplitter -->
                <GridSplitter Grid.Column="1" Width="6"
                              HorizontalAlignment="Center" VerticalAlignment="Stretch"
                              Background="Transparent" Cursor="SizeWE"
                              ShowsPreview="False"/>

                <!-- Right Panel: Details & Actions -->
                <Grid Grid.Column="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- App Details -->
                    <Border Grid.Row="0" Background="{StaticResource BgCardBrush}"
                            BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                            CornerRadius="8" Margin="0,0,0,0" Padding="16,12">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Header with Edit toggle -->
                            <Grid Grid.Row="0">
                                <TextBlock x:Name="SelectedAppName"
                                           Text="アプリを選択してください"
                                           FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI"
                                           FontSize="20" FontWeight="Bold"
                                           Foreground="{StaticResource PrimaryBrush}"
                                           VerticalAlignment="Center"/>
                                <Button x:Name="EditToggleBtn" Content="編集"
                                        Style="{StaticResource SecondaryButton}"
                                        HorizontalAlignment="Right" Padding="12,4"
                                        Click="EditToggle_Click"/>
                            </Grid>

                            <!-- Edit Form (collapsible) -->
                            <Border x:Name="EditPanel" Grid.Row="1" Visibility="Collapsed"
                                    Background="{StaticResource BgPrimaryBrush}"
                                    CornerRadius="6" Margin="0,10,0,0" Padding="12">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="アプリ名:"
                                               Style="{StaticResource EditLabel}"/>
                                    <TextBox x:Name="EditName" Grid.Row="0" Grid.Column="1"
                                             Style="{StaticResource EditField}"
                                             TextChanged="EditName_TextChanged"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="製品コード:"
                                               Style="{StaticResource EditLabel}"/>
                                    <TextBox x:Name="EditProductCode" Grid.Row="1" Grid.Column="1"
                                             Style="{StaticResource EditField}"/>

                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="説明:"
                                               Style="{StaticResource EditLabel}"/>
                                    <TextBox x:Name="EditDescription" Grid.Row="2" Grid.Column="1"
                                             Style="{StaticResource EditField}"/>

                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="リポジトリパス:"
                                               Style="{StaticResource EditLabel}"/>
                                    <Grid Grid.Row="3" Grid.Column="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox x:Name="EditBasePath" Grid.Column="0"
                                                 Style="{StaticResource EditField}"/>
                                        <Button Grid.Column="1" Content="..."
                                                Style="{StaticResource SecondaryButton}"
                                                Padding="8,4" Margin="4,0,0,2"
                                                Click="BrowseEditBasePath_Click"/>
                                    </Grid>

                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="ソリューション:"
                                               Style="{StaticResource EditLabel}"/>
                                    <TextBox x:Name="EditSolutionPath" Grid.Row="4" Grid.Column="1"
                                             Style="{StaticResource EditField}"/>

                                    <TextBlock Grid.Row="5" Grid.Column="0" Text="プロジェクト:"
                                               Style="{StaticResource EditLabel}"/>
                                    <TextBox x:Name="EditProjectPath" Grid.Row="5" Grid.Column="1"
                                             Style="{StaticResource EditField}"/>

                                    <TextBlock Grid.Row="6" Grid.Column="0" Text="テスト:"
                                               Style="{StaticResource EditLabel}"/>
                                    <TextBox x:Name="EditTestPath" Grid.Row="6" Grid.Column="1"
                                             Style="{StaticResource EditField}"/>

                                    <TextBlock Grid.Row="7" Grid.Column="0" Text="exe相対パス:"
                                               Style="{StaticResource EditLabel}"/>
                                    <Grid Grid.Row="7" Grid.Column="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox x:Name="EditExePath" Grid.Column="0"
                                                 Style="{StaticResource EditField}"/>
                                        <Button Grid.Column="1" Content="保存"
                                                Style="{StaticResource PrimaryButton}"
                                                Padding="16,4" Margin="8,0,0,2"
                                                Click="SaveEdit_Click"/>
                                    </Grid>
                                </Grid>
                            </Border>

                            <!-- Path Info -->
                            <Grid Grid.Row="2" Margin="0,8,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="100"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Grid.Column="0" Text="リポジトリ:"
                                           FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                                           FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI" Margin="0,2"/>
                                <TextBlock x:Name="BasePathText" Grid.Row="0" Grid.Column="1"
                                           FontSize="11" Foreground="{StaticResource TextPrimaryBrush}"
                                           FontFamily="Consolas, Cascadia Code" Margin="0,2"
                                           TextTrimming="CharacterEllipsis" Cursor="Hand"
                                           MouseLeftButtonDown="BasePathText_Click"/>

                                <TextBlock Grid.Row="1" Grid.Column="0" Text="ソリューション:"
                                           FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                                           FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI" Margin="0,2"/>
                                <TextBlock x:Name="SolutionPathText" Grid.Row="1" Grid.Column="1"
                                           FontSize="11" Foreground="{StaticResource TextPrimaryBrush}"
                                           FontFamily="Consolas, Cascadia Code" Margin="0,2"
                                           TextTrimming="CharacterEllipsis"/>

                                <TextBlock Grid.Row="2" Grid.Column="0" Text="プロジェクト:"
                                           FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                                           FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI" Margin="0,2"/>
                                <TextBlock x:Name="ProjectPathText" Grid.Row="2" Grid.Column="1"
                                           FontSize="11" Foreground="{StaticResource TextPrimaryBrush}"
                                           FontFamily="Consolas, Cascadia Code" Margin="0,2"
                                           TextTrimming="CharacterEllipsis"/>

                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Debug exe:"
                                           FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                                           FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI" Margin="0,2"/>
                                <TextBlock x:Name="DebugExeText" Grid.Row="3" Grid.Column="1"
                                           FontSize="11" FontFamily="Consolas, Cascadia Code" Margin="0,2"
                                           TextTrimming="CharacterEllipsis" Cursor="Hand"
                                           MouseLeftButtonDown="ExePath_Click"/>

                                <TextBlock Grid.Row="4" Grid.Column="0" Text="Release exe:"
                                           FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                                           FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI" Margin="0,2"/>
                                <TextBlock x:Name="ReleaseExeText" Grid.Row="4" Grid.Column="1"
                                           FontSize="11" FontFamily="Consolas, Cascadia Code" Margin="0,2"
                                           TextTrimming="CharacterEllipsis" Cursor="Hand"
                                           MouseLeftButtonDown="ExePath_Click"/>
                            </Grid>

                            <!-- リリースパイプライン -->
                            <StackPanel Grid.Row="3" Margin="0,12,0,0">
                                <!-- Pipeline: ① → ② → ③ → ④ -->
                                <TextBlock Text="リリース手順"
                                           FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI"
                                           FontSize="12" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,6"/>
                                <WrapPanel>
                                    <Button Content="① ビルド" Style="{StaticResource PrimaryButton}"
                                            Margin="0,0,4,8" Click="BuildRelease_Click"/>
                                    <TextBlock Text="→" VerticalAlignment="Center"
                                               Foreground="{StaticResource TextTertiaryBrush}" Margin="2,0,6,8"/>
                                    <Button Content="② Publish" Style="{StaticResource PrimaryButton}"
                                            Margin="0,0,4,8" Click="Publish_Click"/>
                                    <TextBlock Text="→" VerticalAlignment="Center"
                                               Foreground="{StaticResource TextTertiaryBrush}" Margin="2,0,6,8"/>
                                    <Button Content="③ チェック" Style="{StaticResource SecondaryButton}"
                                            Margin="0,0,4,8" Click="CheckRelease_Click"/>
                                    <TextBlock Text="→" VerticalAlignment="Center"
                                               Foreground="{StaticResource TextTertiaryBrush}" Margin="2,0,6,8"/>
                                    <TextBlock Text="v" FontSize="13" FontWeight="SemiBold"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               VerticalAlignment="Center" Margin="0,0,2,8"
                                               FontFamily="Consolas, Cascadia Code"/>
                                    <TextBox x:Name="VersionInput" Width="72"
                                             Text="1.0.0" FontSize="12"
                                             FontFamily="Consolas, Cascadia Code"
                                             VerticalContentAlignment="Center"
                                             Padding="4,3" Margin="0,0,4,8"
                                             BorderBrush="{StaticResource BorderBrush}"/>
                                    <Button x:Name="ReleaseBtn" Content="④ GitHub Release"
                                            Style="{StaticResource PrimaryButton}"
                                            Margin="0,0,0,8" Click="Release_Click"/>
                                </WrapPanel>

                                <!-- 開発ツール -->
                                <TextBlock Text="開発ツール"
                                           FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI"
                                           FontSize="12" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextTertiaryBrush}" Margin="0,4,0,6"/>
                                <WrapPanel>
                                    <Button Content="Run" Style="{StaticResource SecondaryButton}"
                                            Margin="0,0,8,8" Click="Run_Click"/>
                                    <Button Content="Debug Build" Style="{StaticResource SecondaryButton}"
                                            Margin="0,0,8,8" Click="BuildDebug_Click"/>
                                    <Button Content="Test" Style="{StaticResource SecondaryButton}"
                                            Margin="0,0,8,8" Click="Test_Click"/>
                                    <Button Content="Build All" Style="{StaticResource SecondaryButton}"
                                            Margin="0,0,8,8" Click="BuildAll_Click"/>
                                    <Button Content="フォルダ" Style="{StaticResource SecondaryButton}"
                                            Margin="0,0,8,8" Click="OpenFolder_Click"/>
                                    <Button x:Name="CancelBtn" Content="中断" Style="{StaticResource DangerButton}"
                                            Margin="0,0,8,8" Click="Cancel_Click" IsEnabled="False"/>
                                </WrapPanel>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Status Bar -->
                    <Border Grid.Row="1" Margin="0,8,0,0">
                        <StackPanel Orientation="Horizontal">
                            <Border x:Name="StatusBadge" CornerRadius="4" Padding="8,2"
                                    Background="{StaticResource BgSecondaryBrush}">
                                <TextBlock x:Name="StatusText" Text="待機中"
                                           FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI"
                                           FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </Border>
                        </StackPanel>
                    </Border>

                    <!-- Output Console -->
                    <Border Grid.Row="2" Background="#1C1917"
                            BorderBrush="{StaticResource BorderBrush}" BorderThickness="1"
                            CornerRadius="8" Margin="0,8,0,0" Padding="2">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10,6,0,4">
                                <TextBlock Text="出力コンソール"
                                           FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI"
                                           FontSize="11" Foreground="#A8A29E"/>
                                <Button Content="クリア" Background="Transparent" BorderThickness="0"
                                        Foreground="#A8A29E" FontSize="11" Margin="16,0,0,0"
                                        Cursor="Hand" Click="ClearOutput_Click"
                                        FontFamily="Segoe UI Variable, Segoe UI, Yu Gothic UI"/>
                            </StackPanel>
                            <TextBox x:Name="OutputBox" Grid.Row="1"
                                     IsReadOnly="True" TextWrapping="Wrap"
                                     VerticalScrollBarVisibility="Auto"
                                     Background="Transparent" Foreground="#E7E2DA"
                                     FontFamily="Consolas, Cascadia Code, MS Gothic"
                                     FontSize="12" BorderThickness="0"
                                     Padding="8,4" AcceptsReturn="True"/>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>
